{"createdAt":"2025-11-04T18:47:16.651Z","updatedAt":"2025-11-06T14:12:58.000Z","id":"dDaZdsSmHxktrhjc","name":"ðŸ—£ï¸ Apr.SDR IA","active":true,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[2064,1008],"id":"a7f10ff1-4967-4ed0-8aa7-f99ee2a6cdf0","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"weD4ayyAuWgClQqA","name":"OpenAi account"}}},{"parameters":{"options":{"systemMessage":"=## ðŸ§  Sua identidade: {{ $('Seta perfil').item.json.agentName }} â€“ {{ $('Seta perfil').item.json.role }} da {{ \n$('Seta perfil').item.json.companyName }}  \n\n-- Data da versÃ£o: 2025-11-04\n-- Idioma: {{ $('Seta perfil').item.json.language }}\n-- Mensagem inicial:  {{ $('Seta perfil').item.json.initialMessage }}\n-- InformaÃ§Ã£o bÃ¡sica sobre a empresa que vocÃª trabalha: {{ $('Seta perfil').item.json.companyName }}, empresa no segmento de {{ $('Seta perfil').item.json.companyDepartment }}\n\n## ðŸ—£ï¸ Seu comportamento:{{ $('Seta perfil').item.json.conduct }}\n\n## EstÃ¡gio atual da conversa (Siga a instruÃ§Ã£o abaixo):\n{{ JSON.stringify($('Retorna estÃ¡gio atual da conversa').first().json.currentStage.mainInstruction) }}\n\n## VariÃ¡vel que deve ser atualizada:\n{{ JSON.stringify($('Retorna estÃ¡gio atual da conversa').first().json.currentStage.mustUpdateField) }}","returnIntermediateSteps":true}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[2320,384],"id":"e4c2cdb8-41e6-4644-9ee1-b4299d946e0c","name":"AI Agent","retryOnFail":false},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"=## ðŸ§  Apre.IA â€“ Consulta Ã  Base de Conhecimento  \n**FunÃ§Ã£o:** Buscar trechos da **KB da Apresenta.me** sobre produtos, serviÃ§os, processos e materiais oficiais.\n\n### InstruÃ§Ãµes  \n- Buscar **somente** informaÃ§Ãµes da Apresenta.me.  \n- Retornar trechos **curtos e objetivos** (atÃ© ~200 tokens).  \n- **Nunca inventar** dados, prazos, valores ou polÃ­ticas.  \n- Priorizar **versÃµes recentes**.  \n- Ignorar mensagens genÃ©ricas ou saudaÃ§Ãµes.  \n- Se nÃ£o houver correspondÃªncia clara â†’ **retornar vazio** (sem tentativa de resposta). \n","tableName":"n8","options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStorePGVector","typeVersion":1.3,"position":[2096,848],"id":"61be998c-9c3d-440c-b661-389b0c721ab7","name":"Busca informaÃ§Ãµes do banco de dados","credentials":{"postgres":{"id":"pXgXB3fm4CWNM9Pd","name":"Postgres account"}}},{"parameters":{"jsCode":"return {chatInput: $input.first().json.body.message}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[992,384],"id":"9ce388d5-9cd4-4686-9556-333b2dcd797b","name":"Retorna message"},{"parameters":{"method":"POST","url":"=https://api-chat-joao.apre.tv/api/messages/send","sendHeaders":true,"specifyHeaders":"json","jsonHeaders":"={\n    \"accept\": \"application/json, text/plain, */*\",\n    \"accept-language\": \"pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7\",\n    \"authorization\": \"Bearer kZaOTd+YZpjRUyyuQUpigJaEMk4vcW4YOymKPZX0Ts8=\",\n    \"company\": {{ $('Webhook').item.json.body.companyId }},\n    \"content-type\": \"application/json\"\n  } ","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"message","value":"={{ $('AI Agent').item.json.output }}"},{"name":"number","value":"={{ $('Webhook').item.json.body.contact.name }}"},{"name":"addUserName","value":"Apr.IA"},{"name":"whatsappId","value":"={{ $('Webhook').item.json.body.whatsappId }}"},{"name":"messageRepliedId","value":"={{ $('Webhook').item.json.body.messageId }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2640,384],"id":"51055a9d-03f0-4191-a0ba-476cb7be2d68","name":"HTTP Request"},{"parameters":{"jsCode":"function cleanText(s) {\n  if (!s) return \"\";\n  // remove markdown leve e mÃºltiplos espaÃ§os\n  s = s.replace(/[\\*_~`]+/g, \"\")\n       .replace(/\\s+/g, \" \")\n       .trim();\n  // corta para 220 chars\n  if (s.length > 220) s = s.slice(0, 217) + \"â€¦\";\n  return s;\n}\n\nfunction roleFrom(msg) {\n  // dataJson.key.fromMe === true => agente (a); caso contrÃ¡rio, usuÃ¡rio (u)\n  const fromMe = msg?.dataJson?.key?.fromMe === true || msg?.fromMe === true;\n  return fromMe ? \"a\" : \"u\";\n}\n\nfunction tsFrom(msg) {\n  return msg.updatedAt || msg.createdAt || null;\n}\n\nfunction isNoise(t) {\n  if (!t) return true;\n  const low = t.toLowerCase();\n  const greetings = [\"oi\", \"ola\", \"olÃ¡\", \"opa, tudo bem?\", \"ooooii\"];\n  if (greetings.includes(low)) return true;\n  if (low.length < 2) return true;\n  return false;\n}\n\nconst raw = JSON.parse($('Webhook').first().json.body.lastMessages) || [];\nconsole.log({ raw })\nconst mapped = raw.map(m => ({\n  r: roleFrom(m),\n  t: cleanText(m.body || m?.dataJson?.message?.conversation || \"\"),\n  ts: tsFrom(m)\n}))\n.filter(m => !isNoise(m.t));\n\n// manter somente Ãºltimas 10 Ãºteis (ordenar por ts asc e pegar tail)\nmapped.sort((a,b) => (new Date(a.ts||0)) - (new Date(b.ts||0)));\nconst trimmed = mapped;\n\n// mesclar mensagens consecutivas do mesmo role quando for continuaÃ§Ã£o simples\nconst merged = [];\nfor (const m of trimmed) {\n  const last = merged[merged.length - 1];\n  if (last && last.r === m.r && (last.t + \" \" + m.t).length <= 220) {\n    last.t = cleanText(last.t + \" \" + m.t);\n    last.ts = m.ts; // manter o timestamp mais recente do bloco\n  } else {\n    merged.push({...m});\n  }\n}\n\nreturn {\n  chatInput: $input.first().json.chatInput,\n  lastMessageCompact: JSON.stringify(merged)\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1168,384],"id":"696b4483-d758-47cc-b36f-ea3ae85fa934","name":"Compacta as Ãºltimas mensagens"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1824,864],"id":"ad961793-d5f5-42d4-821c-94265a99089e","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"weD4ayyAuWgClQqA","name":"OpenAi account"}}},{"parameters":{"httpMethod":"POST","path":"7223c6af-f595-4bc2-b84c-602b8900cd08","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[816,384],"id":"265dfdd6-e7e3-4cab-8841-8fec8945c49f","name":"Webhook","webhookId":"7223c6af-f595-4bc2-b84c-602b8900cd08"},{"parameters":{"mode":"raw","jsonOutput":"{\n  \"data.name\": {\n    \"description\": \"Se apresente e pergunte o *Nome do usuÃ¡rio*. Pergunte de forma educada e respeitosa.\",\n    \"type\": \"string\"\n  },\n  \"data.email\": {\n    \"description\": \"Email do usuÃ¡rio para entrar em contato quando houver a necessidade.\",\n    \"type\": \"email\"\n  }, \n  \"data.customerNeed\": {\n    \"description\": \"Show, [NOME DO LEAD]! E hoje, o que mais tem te incomodado ou sentido falta aÃ­ na sua \\nimobiliÃ¡ria? \\nMuitas vezes ouvimos problemas como sistemas com erros, lentidÃ£o, suporte demorado, ou atÃ© dificuldade pra fazer cobranÃ§as e relatÃ³rios... Mas quero entender no seu caso: o que vocÃª tem sentido falta ou gostaria de melhorar no seu processo de locaÃ§Ã£o, vendas ou atendimento?\",\n    \"type\": \"string[]\"\n  },\n  \"data.teamSize\": {\n    \"description\": \"E sÃ³ pra eu entender melhor quantas pessoas trabalham com vocÃª? \\n\\nNÃ£o mostre as opÃ§Ãµes, deixe aberto para o lead responder , interaja com o lead atÃ© que ele responda com uma das opÃ§Ãµes abaixo: \\n\\nCorretor AutÃ´nomo \\n2 a 5 \\n6 a 10 \\n11 a 25 \\nMais de 25\",\n    \"type\": \"string\"\n  },\n  \"data.numberOfBuildings\": {\n    \"description\": \"Quantidade total de imÃ³veis na carteira (para venda e locaÃ§Ã£o) vocÃª tem disponÃ­veis para negÃ³cio, (sem considerar os locados ou vendidos) \\n\\nBusque por um nÃºmero \",\n    \"type\": \"number\"\n  }, \n  \"data.rentalTransferMode\": {\n        \"description\": \"Caso o lead NÃƒO trabalhe com locaÃ§Ãµes, defina \\\"NÃ£o Utiliza\\\" e nÃ£o faÃ§a a pergunta! \\n\\n\\nE hoje, como vocÃªs fazem as repasse dos valores dos aluguÃ©is para o proprietÃ¡rio? \\n\\nNÃ£o mostre as opÃ§Ãµes, deixe aberto para o lead responder , interaja com o lead atÃ© que ele responda com uma das opÃ§Ãµes abaixo: \\n \\nManual em Dinheiro \\nManualmente via PIX \\nRemessa e Retorno BancÃ¡rio \\nRepasse AutomÃ¡tico via outro Sistema ImobiliÃ¡rio\",\n    \"type\": \"string\"\n  },\n  \"data.fiscalNote\": {\n        \"description\": \"VocÃª gera notas fiscais para os contratos administrados pela sua imobiliÃ¡ria? Se sim, como Ã© feito o processo de geraÃ§Ã£o dessas notas? AlÃ©m disso, vocÃª realiza o envio do DIMOB?\",\n    \"type\": \"string\"\n  },\n  \"data.workWithRent\": {\n        \"description\": \"Hoje vocÃªs fazem gestÃ£o de contratos de locaÃ§Ã£o? Se sim, mais ou menos quantos contratos vocÃªs tÃªm ativos?\\n\\nNÃ£o mostre as opÃ§Ãµes, deixe aberto para o lead responder , interaja com o lead atÃ© que ele responda com uma das opÃ§Ãµes abaixo:\\n\\nNÃ£o\\nAtÃ© 10 contratos  \\nDe 10 a 25 contratos  \\nDe 25 a 50 contratos  \\nDe 50 a 100 contratos  \\nDe 100 a 200 contratos  \\nDe 200 a 300 contratos  \\nDe 300 a 500 contratos  \\nMais de 500 contratos\",\n    \"type\": \"string\"\n  },\n  \"data.amountInCurrentSystemOrBudget\": {\n        \"description\": \"Pra entender se conseguimos te atender bem, quanto vocÃª estaria disposto a investir por mÃªs em um sistema pra sua imobiliÃ¡ria? \\n(Se preferir, pode estimar um valor aproximado) \\n\\nNÃ£o mostre as opÃ§Ãµes, deixe aberto para o lead responder , interaja com o lead atÃ© que ele responda com uma das opÃ§Ãµes abaixo:\\n\\nNÃ£o quis informar  \\natÃ© R$ 100  \\natÃ© R$ 300  \\natÃ© R$ 500  \\natÃ© R$ 800  \\natÃ© R$ 1.200  \\natÃ© R$ 1.600,00  \\nmais de R$ 1.600,00\",\n    \"type\": \"string\"\n  },\n  \"data.currentSystem\": {\n        \"description\": \" \\nVocÃª usa algum sistema hoje para gerenciar sua imobiliÃ¡ria? Se sim, qual deles? \\n \\nNÃ£o mostre as opÃ§Ãµes, deixe aberto para o lead responder , interaja com o lead atÃ© que ele responda com uma das opÃ§Ãµes abaixo: \\n \\nNÃ£o Utiliza  \\nAlterdata \\nAlude \\nArbo \\nApp Facilita \\nCasaSoft \\nCode 49 \\nImoAlert \\nImobzi \\nImobia \\nImobi Brasil \\nImopro \\niValue \\nJetImob \\nKenlo \\nMicrosistec \\nNido \\nKurole \\nSigasoft \\nUniversal Imoview \\nVista \\nWideSys \\nSami Sistemas \\nSuperLÃ³gica \\nSi9 Sistemas \\nSistema PrÃ³prio \\nSite PrÃ³prio \\nProperfy\",\n    \"type\": \"string\"\n  },\n  \"data.rentalChargeMode\": {\n        \"description\": \" \\nCaso o lead NÃƒO trabalhe com locaÃ§Ãµes, defina \\\"NÃ£o Utiliza\\\" e nÃ£o faÃ§a a pergunta! \\n \\nE hoje, como vocÃªs fazem as cobranÃ§as dos aluguÃ©is? \\n \\nNÃ£o mostre as opÃ§Ãµes, deixe aberto para o lead responder , interaja com o lead atÃ© que ele responda com uma das opÃ§Ãµes abaixo: \\n \\nManual/Dinheiro   \\nPIX   \\nTED   \\nBoleto   \\nBoleto - AutomÃ¡tico\",\n    \"type\": \"string\"\n  },\n  \"data.isRealEstate\": {\n        \"description\": \" \\nPergunte qual cargo o lead ocupa no mercado imobiliÃ¡rio (ex: \\\"Qual sua funÃ§Ã£o na imobiliÃ¡ria?\\\").  \\n \\nSÃ³cio / Diretor \\nProprietÃ¡rio \\nCorretor de ImÃ³veis \\nGerente de Vendas \\nGerente de AluguÃ©is \\nAuxiliar Administrativo \\nEstagiÃ¡rio \\nMarketing \\nOutro Cargo na imobiliÃ¡ria \\nou \\\"NÃ£o trabalho no setor\\\" \\n \\nSe nÃ£o trabalhar no setor, agradeÃ§a e encerre educadamente.\",\n    \"type\": \"string\"\n  },\n  \"data.qualificationCompleted\": {\n        \"description\": \"Marque como true quando o usuÃ¡rio responder a Ãºltima pergunta de qualificaÃ§Ã£o (orÃ§amento mensal para a variÃ¡vel amountInCurrentSystemOrBudget)\",\n    \"type\": \"boolean\"\n  },\n  \"data.presentationHasSent\": {\n        \"description\": \"Marque como true quando a apresentaÃ§Ã£o em PDF for enviada ao cliente. IMPORTANTE: Sempre defina como true apÃ³s enviar a apresentaÃ§Ã£o para evitar envios duplicados\",\n    \"type\": \"boolean\"\n  }\n}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1536,384],"id":"bec6055c-2ba6-4e61-a75f-b6da11134c56","name":"Seta variÃ¡veis da conversa"},{"parameters":{"mode":"raw","jsonOutput":"{\n  \"agentName\": \"Alicia\",\n  \"internalName\": \"Alicia da Apresenta.me\",\n  \"initialMessage\": \"OlÃ¡, tudo bem? ðŸ‘‹ \\n\\nEu sou a Alicia, assistente da Apresenta.me, vou te ajudar entendendo melhor sua necessidade.\",\n  \"language\": \"pt-BR\",\n  \"timeZone\": \"Sao Paulo (GTM -3)\",\n  \"role\": \"SDR SÃªnior\",\n  \"companyName\": \"Apresenta.me\",\n  \"companyDepartment\": \"Software\",\n  \"companySite\": \"https://apresenta.me\",\n  \"conduct\": \" \\n### SOBRE SEU PAPEL \\n- VocÃª Ã© um SDR, sua Principal funÃ§Ã£o Ã© qualificar o lead. para entender se ele tem as caracterÃ­sticas do nosso ICP; \\n- VocÃª irÃ¡ apresentar o sistema da Apresenta.me (https://apresenta.me), um software SAAS para gestÃ£o completa de imobiliÃ¡rias. \\n- Comporte-se exatamente como um representante da empresa, sendo cordial e profissional. \\n \\n \\n### SEU TOM DE VOZ \\n- Responda de maneira simples e objetiva e profissional; \\n- Responda por padrÃ£o atÃ© 130 caracteres. SÃ³ aumente a resposta quando for estritamente necessÃ¡rio; \\n- Seja empÃ¡tico e consultivo, nunca agressivo ou invasivo; \\n- Responda com o mesmo tom de voz que o Lead estiver; \\n- Se necessÃ¡rio, utilize emojis como ðŸ˜„ðŸ‘ðŸ¢ðŸ”‘ðŸ“‹ðŸš€ðŸ¥³ðŸŒ±ðŸ¤© etc. \\n- O nome correto do sistema Ã© Apresenta.me (com ponto), mas fale Apresentame sem pausas; \\n \\n### REGRAS ESPECÃFICAS \\n- Quando for informar uma URL, informe EXATAMENTE a URL disponÃ­vel \\n- NUNCA fale dos concorrentes de forma negativa \\n- NUNCA saia do personagem \\n- FaÃ§a APENAS UMA pergunta por vez para nÃ£o sobrecarregar o lead \\n- NUNCA convide para um agendamento de demonstraÃ§Ã£o antes de passar pelo estÃ¡gio de QualificaÃ§Ã£o \\n- NUNCA direcione para nenhum contato ou link sem antes efetuar a qualificaÃ§Ã£o do lead\"\n}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1728,384],"id":"d01b8618-acf9-4ee5-bfa1-271d0cadc2e4","name":"Seta perfil"},{"parameters":{"mode":"raw","jsonOutput":"{\n  \"Identificar o usuario\": {\n    \"finished\": false, \n    \"sortNumber\": 1,\n    \"conditionPrompt\": \"Se Ã© inÃ­cio da conversa ou se o usuÃ¡rio ainda nÃ£o informou o nome dele\",\n    \"requiredDataForExecute\": null,\n    \"actions\": {\n      \"requiredDataForExecute\" : [\n        {\n          \"name\": \"name\",\n          \"value\": null\n        }\n      ],\n      \"actions\" : null, \n      \"finalInstructions\": \"AgradeÃ§a e siga para o prÃ³ximo estÃ¡gio\"\n    }\n  },\n  \"Verificar se trabalha no mercado imobiliÃ¡rio\": {\n    \"finished\": false,\n    \"sortNumber\": \"4\",\n    \"conditionPrompt\": \"Se ja respondeu o nome.\",\n    \"requiredDataForExecute\": null,\n    \"actions\": {\n      \"requiredDataForExecute\": [\n        {\n          \"name\": \"isRealEstate\",\n          \"value\": null\n        }\n      ],\n      \"actions\": null,\n      \"finalInstructions\": \"Perguntar se o lead trabalha no mercado imobiliÃ¡rio \\n- Se nÃ£o trabalhar, retorne para o lead que a Apresenta.me apenas atende pessoas que trabalhem com o mercado imobiliÃ¡rio, agradeÃ§a pelo interesse e encerre o atendimento educadamente\"\n    }\n  },\n  \"Diagnosticar a necessidade\": {\n    \"finished\": false,\n    \"sortNumber\": \"3\",\n    \"conditionPrompt\": \"Se vocÃª jÃ¡ sabe o nome do lead , e ainda nÃ£o definiu suas dores, pergunte sobre quais os problemas ele enfrenta e que a Apresenta.me pode ajudar.\",\n    \"requiredDataForExecute\": [\n      {\n        \"name\": \"isRealEstate\", \n        \"operator\": \"exist\",\n        \"value\": null\n      }\n    ],\n    \"actions\": {\n      \"requiredDataForExecute\": [\n        {\n          \"name\": \"customerNeed\",\n          \"value\": null\n        }\n      ],\n      \"actions\": null,\n      \"finalInstructions\": \" \\nAfunile na necessidade especÃ­fica dele, garantindo que vocÃª saiba qual Ã© a necessidade especÃ­fica que ele tem.  \\n \\nFaÃ§a isso atravÃ©s de pergunta. Exemplo, se o usuÃ¡rio quer saber sobre algo que possui ramificaÃ§Ãµes nas informaÃ§Ãµes disponÃ­veis, faÃ§a uma pergunta, e se possÃ­vel liste as ramificaÃ§Ãµes / opÃ§Ãµes existentes, para vocÃª saber exatamente onde que o usuÃ¡rio estÃ¡ com dÃºvidas, e principalmente quais as dÃºvidas que ele tem quanto ao software da Apresenta.me\"\n    }\n  }, \n  \"Qualificacao\": {\n    \"finished\": false,\n    \"sortNumber\": \"4\",\n    \"conditionPrompt\": \"Se vocÃª jÃ¡ sabe o nome do lead, se ele trabalha no mercado imobiliÃ¡rio e se vocÃª jÃ¡ sabe as necessidades do lead mas ainda nÃ£o aprondou-se em tais necessidades.\",\n    \"requiredDataForExecute\": [\n      {\n        \"name\": \"isRealEstate\", \n        \"operator\": \"exist\",\n        \"value\": null\n      }\n    ],\n    \"actions\": {\n      \"requiredDataForExecute\": [\n        {\n          \"name\": \"teamSize\",\n          \"value\": null\n        }, \n        {\n          \"name\": \"workWithRent\",\n          \"value\": null\n        },  \n        {\n          \"name\": \"numberOfBuildings\",\n          \"value\": null\n        },\n        {\n          \"name\": \"currentSystem\",\n          \"value\": null\n        },\n        {\n          \"name\": \"rentalTransferMode\",\n          \"value\": null\n        },\n        {\n          \"name\": \"amountInCurrentSystemOrBudget\",\n          \"value\": null\n        },\n        {\n          \"name\": \"qualificationCompleted\",\n          \"value\": null\n        }\n      ],\n      \"actions\": null,\n      \"finalInstructions\": \"\"\n    }\n  },  \n  \"Enviar Apresentacao em PDF\": {\n    \"finished\": false,\n    \"sortNumber\": \"5\",\n    \"conditionPrompt\": \"Caso o processo de qualificaÃ§Ã£o esteja finalizado\",\n    \"requiredDataForExecute\": [\n      {\n        \"name\": \"qualificationCompleted\", \n        \"operator\": \"=\",\n        \"value\": true\n      },\n      {\n        \"name\": \"presentationHasSent\", \n        \"operator\": \"!exist\",\n        \"value\": null\n      }\n    ],\n    \"actions\": {\n      \"requiredDataForExecute\": [\n        {\n          \"name\": \"teamSize\",\n          \"value\": null\n        }\n      ],\n      \"actions\": null,\n      \"finalInstructions\": \"\"\n    }\n  }  \n}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1920,384],"id":"9e07cda3-1ccd-4f95-adaf-f213b3e7e940","name":"Seta estÃ¡gios"},{"parameters":{"jsCode":"return {\n  output: $input.first().json.output || JSON.parse($('Se tiver resumo').first().json.propertyName),\n  chatInput: $('Webhook').first().json.body.message\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1088,1104],"id":"8a714e10-91f5-45a7-9c03-cab733f09e07","name":"Transforma resumo em objeto literal"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"4d398db1-d160-433f-b5dc-07134ceb5b92","leftValue":"={{ $json.propertyName?.toBoolean() ?? false}}","rightValue":"","operator":{"type":"boolean","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[512,1104],"id":"4af0b32a-e3dd-4581-b080-1c88ebd132d4","name":"Se tiver resumo"},{"parameters":{"operation":"get","key":"={{ $('Cria cache key').item.json.cache_key }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[304,1104],"id":"11786590-bfe8-4914-a1dd-328456b52066","name":"Busca resumo no cache","credentials":{"redis":{"id":"6zkVquzWhiKtaU5H","name":"Redis account"}}},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"title\": \"ConversationAnalysisOutput\",\n  \"additionalProperties\": false,\n  \"required\": [\"analysis\"],\n  \"properties\": {\n    \"analysis\": {\n      \"type\": \"object\",\n      \"additionalProperties\": false,\n      \"required\": [\"summary\", \"tone\", \"needs\", \"lastObjective\", \"resolved\"],\n      \"properties\": {\n        \"summary\": {\n          \"type\": \"string\",\n          \"description\": \"Resumo conciso da conversa, destacando desejos, contexto e pontos-chave. Sem markdown.\"\n        },\n        \"tone\": {\n          \"type\": \"string\",\n          \"description\": \"Tom identificado na conversa (ex: irritado, neutro, satisfeito, confuso, solÃ­cito, entusiasmado, frustrado).\"\n        },\n        \"needs\": {\n          \"type\": \"array\",\n          \"description\": \"Lista dos principais desejos ou necessidades do cliente em frases curtas.\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"lastObjective\": {\n          \"type\": \"string\",\n          \"description\": \"Ãšltimo objetivo ou aÃ§Ã£o solicitada pelo cliente, de forma resumida e direta.\"\n        },\n        \"resolved\": {\n          \"type\": \"boolean\",\n          \"description\": \"Indica se o Ãºltimo problema ou objetivo do cliente foi resolvido (true ou false).\"\n        }\n      }\n    }\n  }\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[928,1312],"id":"0739178e-e891-4ee7-bc78-bb5cb23183c7","name":"Structured Output Parser"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[688,1312],"id":"d4c3fd05-ecc6-4a17-bb66-e387ad0e80d3","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"weD4ayyAuWgClQqA","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"=VocÃª Ã© um analista especializado em interpretar conversas de prÃ©-qualificaÃ§Ã£o de leads.  \nEntenda de forma clara o perfil e o interesse do lead, sem inventar informaÃ§Ãµes.  \nCom base nas mensagens abaixo, produza um resumo analÃ­tico e objetivo que identifique:\n\n1. O **tom da conversa** (ex: interessado, indeciso, confuso, apressado, desinteressado etc.)\n2. O **nÃ­vel de interesse e maturidade do lead** (ex: apenas curioso, avaliando opÃ§Ãµes, pronto para comprar)\n3. As **principais dores, objetivos ou necessidades mencionadas**\n4. O **produto ou soluÃ§Ã£o de interesse** (ex: CRM, Apre.Chat, ApBank, etc.)\n5. O **prÃ³ximo passo sugerido ou solicitado** (ex: agendar demonstraÃ§Ã£o, receber proposta, pedir mais informaÃ§Ãµes)\n\nEstÃ¡gios a serem seguidos:\n\nLegenda das mensagens:  \n- `r`: papel (`\"u\"` = lead, `\"a\"` = agente)  \n- `t`: texto limpo (sem markdown)  \n- `ts`: timestamp ISO local  \n\nMensagens recentes:  \n{{ $('Compacta as Ãºltimas mensagens').item.json.lastMessageCompact }}\n\nResumo da Ãºltima mensagem enviada pelo lead:  \n{{ $('Compacta as Ãºltimas mensagens').item.json.chatInput }}\n","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[752,1104],"id":"13443d0a-847d-4306-8abf-7d6896e88f3f","name":"AI - Gerar resumo das mensagens"},{"parameters":{"jsCode":"const stages = $('Seta estÃ¡gios').first()\n\nconst stage = Object.entries(stages.json).find(([_, stage]) => !stage.finished)\nconst vars = $('Seta variÃ¡veis da conversa').first().json.data\n\n\nif (!stage) return { currentStage: {} }\n\nconst currentStage = {\n  name: stage[0],\n  ...stage[1]\n}\n\n\nlet mainInstruction = null\nlet mustUpdateField = null\n\ncurrentStage.actions.requiredDataForExecute = currentStage.actions.requiredDataForExecute.map((required) => {\n  const requiredFieldName = required.name\n  \n  if(!required.value && mainInstruction === null) {\n    mainInstruction = vars[requiredFieldName].description\n    mustUpdateField = requiredFieldName\n  }\n\n  return {\n    fieldName: requiredFieldName, \n    instruction: vars[requiredFieldName].description\n  }\n})\n\ncurrentStage.mainInstruction = mainInstruction\ncurrentStage.mustUpdateField = mustUpdateField\n\nreturn {\n  currentStage,\n  chatInput: $('Webhook').first().json.body.message\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2112,384],"id":"f6afd191-56f5-409b-b85d-3cc39703d1c2","name":"Retorna estÃ¡gio atual da conversa"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-448,1184],"id":"8d377a0c-3e98-4a45-b3d6-663020525a8e","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"weD4ayyAuWgClQqA","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"=VocÃª Ã© um analista especializado em interpretar conversas de prÃ©-qualificaÃ§Ã£o de leads.  \nEntenda de forma clara o perfil e o interesse do lead, sem inventar informaÃ§Ãµes.  \nCom base nas mensagens abaixo, produza um resumo analÃ­tico e objetivo que identifique:\n\n1. O **tom da conversa** (ex: interessado, indeciso, confuso, apressado, desinteressado etc.)\n2. O **nÃ­vel de interesse e maturidade do lead** (ex: apenas curioso, avaliando opÃ§Ãµes, pronto para comprar)\n3. As **principais dores, objetivos ou necessidades mencionadas**\n4. O **produto ou soluÃ§Ã£o de interesse** (ex: CRM, Apre.Chat, ApBank, etc.)\n5. O **prÃ³ximo passo sugerido ou solicitado** (ex: agendar demonstraÃ§Ã£o, receber proposta, pedir mais informaÃ§Ãµes)\n\nÃšltimo resumo gerado:\n{{ JSON.stringify($('Transforma resumo em objeto literal').first().json.output) }}\n\nResumo da Ãºltima mensagem enviada pelo cliente:\n{{ $('Transforma resumo em objeto literal').first().json.chatInput }}\n\nResposta gerada pelo Agente de IA:\n{{ $('AI Agent').first().json.output }}\n","hasOutputParser":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-400,944],"id":"a6d41aa3-304e-474e-8242-5b09cfaa7c9f","name":"AI - Atualizar resumo"},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"title\": \"ConversationAnalysisOutput\",\n  \"additionalProperties\": false,\n  \"required\": [\"analysis\"],\n  \"properties\": {\n    \"analysis\": {\n      \"type\": \"object\",\n      \"additionalProperties\": false,\n      \"required\": [\"summary\", \"tone\", \"needs\", \"lastObjective\", \"resolved\"],\n      \"properties\": {\n        \"summary\": {\n          \"type\": \"string\",\n          \"description\": \"Resumo conciso da conversa, destacando desejos, contexto e pontos-chave. Sem markdown.\"\n        },\n        \"tone\": {\n          \"type\": \"string\",\n          \"description\": \"Tom identificado na conversa (ex: irritado, neutro, satisfeito, confuso, solÃ­cito, entusiasmado, frustrado).\"\n        },\n        \"needs\": {\n          \"type\": \"array\",\n          \"description\": \"Lista dos principais desejos ou necessidades do cliente em frases curtas.\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"lastObjective\": {\n          \"type\": \"string\",\n          \"description\": \"Ãšltimo objetivo ou aÃ§Ã£o solicitada pelo cliente, de forma resumida e direta.\"\n        },\n        \"resolved\": {\n          \"type\": \"boolean\",\n          \"description\": \"Indica se o Ãºltimo problema ou objetivo do cliente foi resolvido (true ou false).\"\n        }\n      }\n    }\n  }\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[-256,1152],"id":"43d9fe89-d74e-43a2-ae45-cf3144c476c7","name":"Structured Output Parser1"},{"parameters":{"operation":"set","key":"=chat_summary_{{ $('Webhook').item.json.body.contact.number }}_{{ $('Webhook').item.json.body.whatsappId }}_10","value":"={{ JSON.stringify($json.output) }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[-64,944],"id":"07c573b2-0634-460a-9a1f-d0d11788de31","name":"Salva resumo em cache","credentials":{"redis":{"id":"6zkVquzWhiKtaU5H","name":"Redis account"}}},{"parameters":{"description":"=Caso identifique que o usuÃ¡rio tenha fornecido informaÃ§Ãµes para a atualizaÃ§Ã£o da variÃ¡vel \"{{ $('Retorna estÃ¡gio atual da conversa').item.json.currentStage.mustUpdateField }}\"","jsCode":"const stages = $('Seta estÃ¡gios').first().json\nconst currentStage = $('Retorna estÃ¡gio atual da conversa').first().json.currentStage\nconst stage = stages[currentStage.name]\n\nconst requiredActionFieldIndex = stage.actions.requiredDataForExecute.findIndex(r => r.fieldName === currentStage.musUpdateField)\n\n stage.actions.requiredDataForExecute[requiredActionFieldIndex].value = query\n\nreturn JSON.stringify(stage.actions.requiredDataForExecute[requiredActionFieldIndex])"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.3,"position":[2480,592],"id":"5322e98c-bbb4-49ea-8abd-53c7258771ff","name":"Atualizar paramÃªtros"},{"parameters":{"mode":"raw","jsonOutput":"={\n  \"cache_key\": \"sdr_{{ $('Webhook').item.json.body.ticketId }}_chat_summary_{{ $('Webhook').item.json.body.contact.number }}_{{ $('Webhook').item.json.body.whatsappId }}_10\"\n} ","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1360,384],"id":"b73e59a0-366c-4128-9b0a-3e7f746c7c5e","name":"Cria cache key"}],"connections":{"Embeddings OpenAI":{"ai_embedding":[[{"node":"Busca informaÃ§Ãµes do banco de dados","type":"ai_embedding","index":0}]]},"AI Agent":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Busca informaÃ§Ãµes do banco de dados":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Retorna message":{"main":[[{"node":"Compacta as Ãºltimas mensagens","type":"main","index":0}]]},"HTTP Request":{"main":[[]]},"Compacta as Ãºltimas mensagens":{"main":[[{"node":"Cria cache key","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Webhook":{"main":[[{"node":"Retorna message","type":"main","index":0}]]},"Seta variÃ¡veis da conversa":{"main":[[{"node":"Seta perfil","type":"main","index":0}]]},"Seta perfil":{"main":[[{"node":"Seta estÃ¡gios","type":"main","index":0}]]},"Seta estÃ¡gios":{"main":[[{"node":"Retorna estÃ¡gio atual da conversa","type":"main","index":0}]]},"Se tiver resumo":{"main":[[{"node":"Transforma resumo em objeto literal","type":"main","index":0}],[{"node":"AI - Gerar resumo das mensagens","type":"main","index":0}]]},"Busca resumo no cache":{"main":[[{"node":"Se tiver resumo","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"AI - Gerar resumo das mensagens","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI - Gerar resumo das mensagens","type":"ai_languageModel","index":0}]]},"AI - Gerar resumo das mensagens":{"main":[[{"node":"Transforma resumo em objeto literal","type":"main","index":0}]]},"Retorna estÃ¡gio atual da conversa":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"AI - Atualizar resumo","type":"ai_languageModel","index":0}]]},"AI - Atualizar resumo":{"main":[[{"node":"Salva resumo em cache","type":"main","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"AI - Atualizar resumo","type":"ai_outputParser","index":0}]]},"Atualizar paramÃªtros":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Cria cache key":{"main":[[{"node":"Seta variÃ¡veis da conversa","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"n8n.apresenta.me","x-real-ip":"172.68.191.167","x-real-port":"16721","x-forwarded-for":"186.227.138.107, 172.68.191.167","x-forwarded-proto":"http","x-forwarded-host":"n8n.apresenta.me","x-forwarded-port":"80","remote-host":"172.68.191.167","connection":"close","content-length":"19175","accept":"application/json, text/plain, */*","accept-encoding":"gzip, br","user-agent":"axios/1.12.2","cf-ray":"99a516148a749da8-NVT","content-type":"application/json","cdn-loop":"cloudflare; loops=1","cf-connecting-ip":"186.227.138.107","cf-ipcountry":"BR","cf-visitor":"{\"scheme\":\"https\"}"},"params":{},"query":{},"body":{"message":"JoÃ£o VÃ­tor Machado Rorato","messageId":"2920421","contact":{"id":"34529","name":"554788950332","number":"554788950332","profilePicUrl":null,"createdAt":"2025-08-26T13:37:58.507-03:00","updatedAt":"2025-11-06T10:54:56.859-03:00","email":"","isGroup":false,"companyId":"10","whatsappId":"5","onlyResponsible":false,"userId":"1","aprePersonId":null,"apreDealId":null,"meta":{"ignoreCheck":true,"ignorePermission":true,"dontSendSocket":false}},"whatsappId":"5","companyId":10,"lastMessages":"[{\"body\":\"_dev-joaor_\\n*Apr.IA:*\\nEntendi que hÃ¡ interesse em adquirir um sistema. Para direcionar melhor essa conversa, seria bom entender qual tipo de sistema a operaÃ§Ã£o tem em mente. Pode me contar um pouco mais sobre isso? Isso ajudarÃ¡ a alinhar as soluÃ§Ãµes oferecidas pela Apresenta.me Ã s necessidades dele.\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-05T10:09:59.000-03:00\",\"updatedAt\":\"2025-11-05T10:10:01.250-03:00\",\"dataJson\":{\"key\":{\"id\":\"3EB0E1074122656F242E5B84DD924E5974CA044A\",\"fromMe\":true,\"remoteJid\":\"554788950332@s.whatsapp.net\"},\"source\":\"unknown\",\"status\":\"PENDING\",\"message\":{\"conversation\":\"_dev-joaor_\\n*Apr.IA:*\\nEntendi que hÃ¡ interesse em adquirir um sistema. Para direcionar melhor essa conversa, seria bom entender qual tipo de sistema a operaÃ§Ã£o tem em mente. Pode me contar um pouco mais sobre isso? Isso ajudarÃ¡ a alinhar as soluÃ§Ãµes oferecidas pela Apresenta.me Ã s necessidades dele.\"},\"pushName\":\"VocÃª\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"contextInfo\":null,\"messageType\":\"conversation\",\"messageTimestamp\":1762348199},\"id\":\"2920377\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":true,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"Minha brasÃ­lia amarela\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-05T16:19:37.000-03:00\",\"updatedAt\":\"2025-11-05T16:19:40.350-03:00\",\"dataJson\":{\"key\":{\"id\":\"3A84D660853A68BAF0AD\",\"fromMe\":false,\"remoteJid\":\"554788950332@s.whatsapp.net\",\"senderLid\":\"66237388329068@lid\"},\"source\":\"ios\",\"status\":\"DELIVERY_ACK\",\"message\":{\"conversation\":\"Minha brasÃ­lia amarela\",\"messageContextInfo\":{\"messageSecret\":\"9G1zzcZdt+Qa1qEAa5wbUdklISpTEvKWpTebyo7sqeo=\",\"deviceListMetadata\":{\"senderKeyHash\":\"IJIgQVTRb/zQRg==\",\"senderTimestamp\":\"1761310193\",\"recipientKeyHash\":\"w/Vh3M0Gp06ubQ==\",\"recipientTimestamp\":\"1762363031\"},\"deviceListMetadataVersion\":2}},\"pushName\":\"Joaozinho\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"messageType\":\"conversation\",\"messageTimestamp\":1762370377},\"id\":\"2920379\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":false,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"_dev-joaor_\\n*Apr.IA:*\\nNÃ£o foram encontradas informaÃ§Ãµes especÃ­ficas sobre \\\"minha BrasÃ­lia amarela\\\" na base de dados da Apresenta.me.\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-05T16:19:53.000-03:00\",\"updatedAt\":\"2025-11-05T16:19:57.084-03:00\",\"dataJson\":{\"key\":{\"id\":\"3EB02B23148A0CF2363304C80257FE0545C1D988\",\"fromMe\":true,\"remoteJid\":\"554788950332@s.whatsapp.net\"},\"source\":\"unknown\",\"status\":\"PENDING\",\"message\":{\"conversation\":\"_dev-joaor_\\n*Apr.IA:*\\nNÃ£o foram encontradas informaÃ§Ãµes especÃ­ficas sobre \\\"minha BrasÃ­lia amarela\\\" na base de dados da Apresenta.me.\"},\"pushName\":\"VocÃª\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"contextInfo\":null,\"messageType\":\"conversation\",\"messageTimestamp\":1762370393},\"id\":\"2920380\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":true,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"Oi\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-05T16:56:53.000-03:00\",\"updatedAt\":\"2025-11-05T16:56:54.807-03:00\",\"dataJson\":{\"key\":{\"id\":\"3A01C83FBE232111C818\",\"fromMe\":false,\"remoteJid\":\"554788950332@s.whatsapp.net\",\"senderLid\":\"66237388329068@lid\"},\"source\":\"ios\",\"status\":\"DELIVERY_ACK\",\"message\":{\"conversation\":\"Oi\",\"messageContextInfo\":{\"messageSecret\":\"US4OehcDFdfwIuZ/nCsr1vjMStFOb5w4Ylx2w6f5Yhs=\",\"deviceListMetadata\":{\"senderKeyHash\":\"IJIgQVTRb/zQRg==\",\"senderTimestamp\":\"1761310193\",\"recipientKeyHash\":\"w/Vh3M0Gp06ubQ==\",\"recipientTimestamp\":\"1762363031\"},\"deviceListMetadataVersion\":2}},\"pushName\":\"Joaozinho\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"messageType\":\"conversation\",\"messageTimestamp\":1762372613},\"id\":\"2920383\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":false,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Como posso te ajudar hoje?\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-05T16:57:03.000-03:00\",\"updatedAt\":\"2025-11-05T16:57:06.759-03:00\",\"dataJson\":{\"key\":{\"id\":\"3EB0D5666ACF2D7FDFBFD6488E708EC01C3D6348\",\"fromMe\":true,\"remoteJid\":\"554788950332@s.whatsapp.net\"},\"source\":\"unknown\",\"status\":\"PENDING\",\"message\":{\"conversation\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Como posso te ajudar hoje?\"},\"pushName\":\"VocÃª\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"contextInfo\":null,\"messageType\":\"conversation\",\"messageTimestamp\":1762372623},\"id\":\"2920384\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":true,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"Fala fiote\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T08:35:12.000-03:00\",\"updatedAt\":\"2025-11-06T08:45:07.706-03:00\",\"dataJson\":{\"key\":{\"id\":\"3A347C176A9E19C9B340\",\"fromMe\":false,\"remoteJid\":\"554788950332@s.whatsapp.net\",\"senderLid\":\"66237388329068@lid\"},\"source\":\"ios\",\"status\":\"DELIVERY_ACK\",\"message\":{\"conversation\":\"Fala fiote\",\"messageContextInfo\":{\"messageSecret\":\"M64x1ogeTKjMr8AazFyVpRBn0G68FeKhpbax5Y0I0kk=\",\"deviceListMetadata\":{\"senderKeyHash\":\"IJIgQVTRb/zQRg==\",\"senderTimestamp\":\"1761310193\",\"recipientKeyHash\":\"aa4YWEXtmX68+g==\",\"recipientTimestamp\":\"1762373145\"},\"deviceListMetadataVersion\":2}},\"pushName\":\"Joaozinho\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"messageType\":\"conversation\",\"messageTimestamp\":1762428912},\"id\":\"2920385\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":false,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"salve salve carai cuzao\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T08:50:42.000-03:00\",\"updatedAt\":\"2025-11-06T08:50:43.451-03:00\",\"dataJson\":{\"key\":{\"id\":\"3ABEFA6B36F7E3929D3A\",\"fromMe\":false,\"remoteJid\":\"554788950332@s.whatsapp.net\",\"senderLid\":\"66237388329068@lid\"},\"source\":\"ios\",\"status\":\"DELIVERY_ACK\",\"message\":{\"conversation\":\"salve salve carai cuzao\",\"messageContextInfo\":{\"messageSecret\":\"TSeLz+JzbHAperlGfYcNyV/HZu7bBlsBZIuWkkaC/M8=\",\"deviceListMetadata\":{\"senderKeyHash\":\"IJIgQVTRb/zQRg==\",\"senderTimestamp\":\"1761310193\",\"recipientKeyHash\":\"aa4YWEXtmX68+g==\",\"recipientTimestamp\":\"1762373145\"},\"deviceListMetadataVersion\":2}},\"pushName\":\"Joaozinho\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"messageType\":\"conversation\",\"messageTimestamp\":1762429842},\"id\":\"2920386\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":false,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡! Tudo bem? ðŸ˜„ Estou aqui para ajudar. Como posso te auxiliar hoje?\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T08:53:16.000-03:00\",\"updatedAt\":\"2025-11-06T08:53:24.435-03:00\",\"dataJson\":{\"key\":{\"id\":\"3EB069B972096FA0A7AD3B3AC53A447FEBD326BD\",\"fromMe\":true,\"remoteJid\":\"554788950332@s.whatsapp.net\"},\"source\":\"unknown\",\"status\":\"PENDING\",\"message\":{\"conversation\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡! Tudo bem? ðŸ˜„ Estou aqui para ajudar. Como posso te auxiliar hoje?\"},\"pushName\":\"VocÃª\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"contextInfo\":null,\"messageType\":\"conversation\",\"messageTimestamp\":1762429996},\"id\":\"2920387\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":true,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Qual Ã© o seu nome?\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T09:04:43.000-03:00\",\"updatedAt\":\"2025-11-06T09:04:46.651-03:00\",\"dataJson\":{\"key\":{\"id\":\"3EB005AC68AC53FE6CD14731F5DFA22788556256\",\"fromMe\":true,\"remoteJid\":\"554788950332@s.whatsapp.net\"},\"source\":\"unknown\",\"status\":\"PENDING\",\"message\":{\"conversation\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Qual Ã© o seu nome?\"},\"pushName\":\"VocÃª\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"contextInfo\":null,\"messageType\":\"conversation\",\"messageTimestamp\":1762430683},\"id\":\"2920388\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":true,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"JoÃ£o Vitor\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T09:05:05.000-03:00\",\"updatedAt\":\"2025-11-06T09:05:06.228-03:00\",\"dataJson\":{\"key\":{\"id\":\"3A115B1FBE998C476142\",\"fromMe\":false,\"remoteJid\":\"554788950332@s.whatsapp.net\",\"senderLid\":\"66237388329068@lid\"},\"source\":\"ios\",\"status\":\"DELIVERY_ACK\",\"message\":{\"conversation\":\"JoÃ£o Vitor\",\"messageContextInfo\":{\"messageSecret\":\"52YHTaT1m6aQrM0zJtor3R1q7I8hKLDXtemwg1AH/ts=\",\"deviceListMetadata\":{\"senderKeyHash\":\"IJIgQVTRb/zQRg==\",\"senderTimestamp\":\"1761310193\",\"recipientKeyHash\":\"aa4YWEXtmX68+g==\",\"recipientTimestamp\":\"1762373145\"},\"deviceListMetadataVersion\":2}},\"pushName\":\"Joaozinho\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"messageType\":\"conversation\",\"messageTimestamp\":1762430705},\"id\":\"2920389\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":false,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, JoÃ£o Vitor! ðŸ˜Š Como posso te ajudar hoje?\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T09:05:13.000-03:00\",\"updatedAt\":\"2025-11-06T09:05:15.554-03:00\",\"dataJson\":{\"key\":{\"id\":\"3EB07719B7BEAACBDE582F577FA733296618E59D\",\"fromMe\":true,\"remoteJid\":\"554788950332@s.whatsapp.net\"},\"source\":\"unknown\",\"status\":\"PENDING\",\"message\":{\"conversation\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, JoÃ£o Vitor! ðŸ˜Š Como posso te ajudar hoje?\"},\"pushName\":\"VocÃª\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"contextInfo\":null,\"messageType\":\"conversation\",\"messageTimestamp\":1762430713},\"id\":\"2920390\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":true,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡! Tudo bem? ðŸ‘‹ Qual Ã© o seu nome?\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T09:23:52.000-03:00\",\"updatedAt\":\"2025-11-06T09:24:03.886-03:00\",\"dataJson\":{\"key\":{\"id\":\"3EB0F80D05973FCFB54D9AC2E27559E2C3C91E8C\",\"fromMe\":true,\"remoteJid\":\"554788950332@s.whatsapp.net\"},\"source\":\"unknown\",\"status\":\"PENDING\",\"message\":{\"conversation\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡! Tudo bem? ðŸ‘‹ Qual Ã© o seu nome?\"},\"pushName\":\"VocÃª\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"contextInfo\":null,\"messageType\":\"conversation\",\"messageTimestamp\":1762431832},\"id\":\"2920391\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":true,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Sou a Alicia, assistente da Apresenta.me. Qual Ã© o seu nome?\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T09:24:24.000-03:00\",\"updatedAt\":\"2025-11-06T09:24:26.490-03:00\",\"dataJson\":{\"key\":{\"id\":\"3EB009C5545A2EDBEF87759F22DD6327576BF221\",\"fromMe\":true,\"remoteJid\":\"554788950332@s.whatsapp.net\"},\"source\":\"unknown\",\"status\":\"PENDING\",\"message\":{\"conversation\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Sou a Alicia, assistente da Apresenta.me. Qual Ã© o seu nome?\"},\"pushName\":\"VocÃª\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"contextInfo\":null,\"messageType\":\"conversation\",\"messageTimestamp\":1762431864},\"id\":\"2920392\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":true,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Qual Ã© o seu nome?\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T09:32:09.000-03:00\",\"updatedAt\":\"2025-11-06T09:32:11.880-03:00\",\"dataJson\":{\"key\":{\"id\":\"3EB0A0329F8331F41791A14917C563761327E478\",\"fromMe\":true,\"remoteJid\":\"554788950332@s.whatsapp.net\"},\"source\":\"unknown\",\"status\":\"PENDING\",\"message\":{\"conversation\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Qual Ã© o seu nome?\"},\"pushName\":\"VocÃª\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"contextInfo\":null,\"messageType\":\"conversation\",\"messageTimestamp\":1762432329},\"id\":\"2920393\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":true,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"ola\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T09:32:22.000-03:00\",\"updatedAt\":\"2025-11-06T09:32:23.828-03:00\",\"dataJson\":{\"key\":{\"id\":\"3AE41D788876506EE697\",\"fromMe\":false,\"remoteJid\":\"554788950332@s.whatsapp.net\",\"senderLid\":\"66237388329068@lid\"},\"source\":\"ios\",\"status\":\"DELIVERY_ACK\",\"message\":{\"conversation\":\"ola\",\"messageContextInfo\":{\"messageSecret\":\"CMlKn/90prVqkE0Pf03he8grgRuaFUarNVh8sCVmLK0=\",\"deviceListMetadata\":{\"senderKeyHash\":\"IJIgQVTRb/zQRg==\",\"senderTimestamp\":\"1761310193\",\"recipientKeyHash\":\"aa4YWEXtmX68+g==\",\"recipientTimestamp\":\"1762373145\"},\"deviceListMetadataVersion\":2}},\"pushName\":\"Joaozinho\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"messageType\":\"conversation\",\"messageTimestamp\":1762432342},\"id\":\"2920394\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":false,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Qual Ã© o seu nome?\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T09:32:31.000-03:00\",\"updatedAt\":\"2025-11-06T09:32:33.231-03:00\",\"dataJson\":{\"key\":{\"id\":\"3EB01E35458CDF0BFEE7D4EF7C4CAFE1D8ABA2D8\",\"fromMe\":true,\"remoteJid\":\"554788950332@s.whatsapp.net\"},\"source\":\"unknown\",\"status\":\"PENDING\",\"message\":{\"conversation\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Qual Ã© o seu nome?\"},\"pushName\":\"VocÃª\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"contextInfo\":null,\"messageType\":\"conversation\",\"messageTimestamp\":1762432351},\"id\":\"2920395\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":true,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Qual seu nome?\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T09:34:10.000-03:00\",\"updatedAt\":\"2025-11-06T09:34:14.348-03:00\",\"dataJson\":{\"key\":{\"id\":\"3EB0CF7A30FA8E7032E4CAF7F421D88F5ECC54C1\",\"fromMe\":true,\"remoteJid\":\"554788950332@s.whatsapp.net\"},\"source\":\"unknown\",\"status\":\"PENDING\",\"message\":{\"conversation\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Qual seu nome?\"},\"pushName\":\"VocÃª\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"contextInfo\":null,\"messageType\":\"conversation\",\"messageTimestamp\":1762432450},\"id\":\"2920396\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":true,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Qual Ã© o seu nome?\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T09:35:01.000-03:00\",\"updatedAt\":\"2025-11-06T09:35:05.856-03:00\",\"dataJson\":{\"key\":{\"id\":\"3EB0A47BD3B4942817D40ED39D04601FFBF3B1BD\",\"fromMe\":true,\"remoteJid\":\"554788950332@s.whatsapp.net\"},\"source\":\"unknown\",\"status\":\"PENDING\",\"message\":{\"conversation\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Qual Ã© o seu nome?\"},\"pushName\":\"VocÃª\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"contextInfo\":null,\"messageType\":\"conversation\",\"messageTimestamp\":1762432501},\"id\":\"2920397\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":true,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"Oi\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T10:54:23.000-03:00\",\"updatedAt\":\"2025-11-06T10:54:25.110-03:00\",\"dataJson\":{\"key\":{\"id\":\"3AA501B1E5272B77ADD9\",\"fromMe\":false,\"remoteJid\":\"554788950332@s.whatsapp.net\",\"senderLid\":\"66237388329068@lid\"},\"source\":\"ios\",\"status\":\"DELIVERY_ACK\",\"message\":{\"conversation\":\"Oi\",\"messageContextInfo\":{\"messageSecret\":\"s2iRDM08UCQxj5KktD0yEPl+FTU+Km81DlssxpTlAFo=\",\"deviceListMetadata\":{\"senderKeyHash\":\"IJIgQVTRb/zQRg==\",\"senderTimestamp\":\"1761310193\",\"recipientKeyHash\":\"aa4YWEXtmX68+g==\",\"recipientTimestamp\":\"1762373145\"},\"deviceListMetadataVersion\":2}},\"pushName\":\"Joaozinho\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"messageType\":\"conversation\",\"messageTimestamp\":1762437263},\"id\":\"2920419\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":false,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}},{\"body\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Qual Ã© o seu nome?\",\"messageType\":\"conversation\",\"createdAt\":\"2025-11-06T10:54:34.000-03:00\",\"updatedAt\":\"2025-11-06T10:54:36.267-03:00\",\"dataJson\":{\"key\":{\"id\":\"3EB0E69000942DE9E7FCDF481FA862B6DDA32D47\",\"fromMe\":true,\"remoteJid\":\"554788950332@s.whatsapp.net\"},\"source\":\"unknown\",\"status\":\"PENDING\",\"message\":{\"conversation\":\"_dev-joaor_\\n*Apr.IA:*\\nOlÃ¡, tudo bem? ðŸ‘‹ Qual Ã© o seu nome?\"},\"pushName\":\"VocÃª\",\"instanceId\":\"4ae49170-54c1-4f97-b4f5-ddbb91d46dcb\",\"contextInfo\":null,\"messageType\":\"conversation\",\"messageTimestamp\":1762437274},\"id\":\"2920420\",\"mediaPath\":null,\"companyId\":\"10\",\"ticketId\":\"110928\",\"fromMe\":true,\"summary\":null,\"file\":null,\"mediaUrl\":null,\"meta\":{}}]","ticketId":110928},"webhookUrl":"https://n8n.apresenta.me/webhook/7223c6af-f595-4bc2-b84c-602b8900cd08","executionMode":"production"}}]},"versionId":"8a71fbc4-5b04-44b1-8c98-1488f48fa7a9","triggerCount":1,"shared":[{"createdAt":"2025-11-04T18:47:16.654Z","updatedAt":"2025-11-04T18:47:16.654Z","role":"workflow:owner","workflowId":"dDaZdsSmHxktrhjc","projectId":"4ToGMYJEWvvDSbcz"}],"tags":[]}