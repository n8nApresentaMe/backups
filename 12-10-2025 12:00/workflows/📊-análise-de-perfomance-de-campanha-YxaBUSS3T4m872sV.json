{"createdAt":"2025-09-22T19:32:48.292Z","updatedAt":"2025-10-09T18:15:48.000Z","id":"YxaBUSS3T4m872sV","name":"📊 Análise de perfomance de campanha","active":true,"isArchived":false,"nodes":[{"parameters":{"jsCode":"return {\n  campaigns: $input.first().json.data.map(d => d.campaign_id)\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[928,144],"id":"256d3e96-fc58-4807-9205-1070b4e934d1","name":"Pega os ids das campanhas com insights"},{"parameters":{"jsCode":"const campaigns = $input.first().json.data\nconst insights = $('Busca insights').first().json.data\n\nfor(const campaign of campaigns) {\n  const campaignInsights = insights.find(i => String(i.campaign_id) === String(campaign.id)) \n  campaign.insights = campaignInsights\n}\n\nreturn {\n  campaigns\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1328,144],"id":"66c75ac7-1019-499f-8023-dd95780189ba","name":"Junta as informações de campanha com insights"},{"parameters":{"graphApiVersion":"v20.0","node":"act_1000490853790213","edge":"insights","options":{"queryParametersJson":"={\n  \"fields\": \"account_id,campaign_id,impressions,spend,clicks,ctr,cpc,cpm,reach,frequency,actions,cost_per_action_type,created_time,date_start,date_stop\",\n  \"date_preset\": \"{{ $json.date_preset }}\",\n  \"level\": \"campaign\",\n  \"time_increment\": \"1\"\n}\n "}},"type":"n8n-nodes-base.facebookGraphApi","typeVersion":1,"position":[720,144],"id":"5f75e7da-d787-443c-97a1-672b0e49995c","name":"Busca insights","credentials":{"facebookGraphApi":{"id":"Ex5QxAzJUnZDVBU4","name":"Facebook Graph account"}}},{"parameters":{"graphApiVersion":"v20.0","node":"act_1000490853790213","edge":"campaigns","options":{"queryParametersJson":"={\n  \"filtering\":\n  [\n      {\n          \"field\":\"id\",\n          \"operator\":\"IN\",\n          \"value\":[\"{{ $json.campaigns.join('\", \"') }}\"]\n      }\n  ],\n  \"fields\":\"id,name,status,objective\"\n} "}},"type":"n8n-nodes-base.facebookGraphApi","typeVersion":1,"position":[1136,144],"id":"e139d764-0f30-47cd-9a88-597bf4c6151b","name":"Busca campanhas","credentials":{"facebookGraphApi":{"id":"Ex5QxAzJUnZDVBU4","name":"Facebook Graph account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"claude-sonnet-4-20250514","cachedResultName":"Claude 4 Sonnet"},"options":{"maxTokensToSample":10000}},"type":"@n8n/n8n-nodes-langchain.lmChatAnthropic","typeVersion":1.3,"position":[2000,384],"id":"2ec2a270-2661-4a7b-8e94-a3c8af54f51e","name":"Anthropic Chat Model2","credentials":{"anthropicApi":{"id":"lyfyzPeMl3RhkeP5","name":"Anthropic account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"claude-sonnet-4-20250514","cachedResultName":"Claude 4 Sonnet"},"options":{"maxTokensToSample":20000}},"type":"@n8n/n8n-nodes-langchain.lmChatAnthropic","typeVersion":1.3,"position":[2576,384],"id":"f35c8243-e7de-42a9-9c23-a096468f1f67","name":"Anthropic Chat Model3","credentials":{"anthropicApi":{"id":"lyfyzPeMl3RhkeP5","name":"Anthropic account"}}},{"parameters":{"promptType":"define","text":"=Você é um especialista em Meta Ads com 10 anos de experiência.\nSempre que receber dados brutos de campanhas através do JSON:\n\nrealize diretamente a análise e retorne o relatório completo.\n{{ JSON.stringify($('Junta as informações de campanha com insights').first().json.campaigns) }}\n\nATENÇÃO: ESTA ANÁLISE REFERE-SE A CAMPANHAS NO PERÍODO {{ $('Formata data').first().json.period_type_translated.toUpperCase() }}\n------------------------------------------------------------\n1. Cálculos obrigatórios\n------------------------------------------------------------\n- CTR_link = cliques_link / imp (0 se imp=0)\n- CPC_link = gasto / cliques_link (∞/“—” se cliques_link=0)\n- Click→Lead = leads / cliques_link (0 se cliques_link=0)\n- CPL = gasto / leads (∞/“—” se leads=0)\n\nDeltas (atual vs. anterior):\n- Δ absoluto = valor_atual - valor_anterior\n- Δ % = (valor_atual - valor_anterior) / max(ε, |valor_anterior|), ε=1e-9\n\nClassificação das variações (%):\n- ✅ Melhorou: custo ↓ ≥10% ou eficiência ↑ ≥10%\n- ⚖️ Estável: entre -10% e +10%\n- ❌ Piorou: custo ↑ ≥10% ou eficiência ↓ ≥10%\n\n------------------------------------------------------------\n2. Qualidade da amostra\n------------------------------------------------------------\nConsiderar “conclusivo” apenas se:\n- imp_atual ≥ 1000 ou\n- cliques_link_atual ≥ 30 ou\n- gasto_atual ≥ 100\n\nCaso contrário, marque como “amostra baixa” e trate recomendações como exploratórias.\n\n------------------------------------------------------------\n3. Comparar com metas\n------------------------------------------------------------\nMetas de performance:\n- 🎯 CPM alvo = R$35,00\n- 🎯 CTR alvo = 0,50%\n- 🎯 Click→Lead alvo = 5%\n- 🎯 CPL alvo = R$110,00\n\nClassifique cada métrica como:\n- ⬇️ Abaixo da meta\n- 🟢 Dentro da meta\n- ⬆️ Acima da meta\n\nMostre valor atual, meta e desvio (valor + %).\n\n------------------------------------------------------------\n4. Identificar causas prováveis (gargalos do funil)\n------------------------------------------------------------\nUse como guia:\n- 📈 CPM alto → público pequeno, frequência alta\n- 🖼 CTR baixo → criativo fraco (gancho, copy, visual, áudio)\n- 📝 Click→Lead baixo → formulário com fricção (campos excessivos)\n- 💸 CPL alto → reflexo de gargalos anteriores (CPM, CTR ou Click→Lead)\n\n------------------------------------------------------------\n5. Recomendações práticas\n------------------------------------------------------------\nPara cada gargalo identificado, sugira:\n- 🖌 Criativo → novos ganchos, copy, visual, áudio\n- 🎯 Segmentação → expandir público, excluir faixas ruins\n- 📋 Landing/Formulário → reduzir atrito, revisar campos obrigatórios\n- 💰 Orçamento/Lances → redistribuir verba entre conjuntos melhores\n- ⚡ Testes A/B → validar hipóteses rapidamente\n\n------------------------------------------------------------\n6. Estrutura final da análise (saída)\n------------------------------------------------------------\nO relatório deve ser entregue em TEXTO, dividido em seções com emojis, no seguinte formato:\n\n- 📊 **Resumo Executivo** → visão geral em 2–3 frases\n- 📌 **Desvios Identificados** → tabela/lista com metas vs resultados\n- 🔎 **Análise dos Nós do Funil** → explicação dos gargalos encontrados\n- 💡 **Sugestões de Otimização** → recomendações práticas e acionáveis\n- 🗒 **Observações** → limitações de amostra, mudanças de budget, sazonalidade, etc.\n\n--------------------- 7. NOVA ANÁLISE (COMPARATIVA) -------------------------\n## ATENÇÃO: Separar os próximos itens da análise principal para que facilite ao gestor de tráfego a leitura dos ganhos e perdas em relação às ultimas análises de campanha\n\n============================================================\n1) SEU PAPEL\n============================================================\nOBS: Considere como análise atual a análise feita antes de \"7. NOVA ANÁLISE (COMPARATIVA)\"\nVocê é um(a) analista de dados focado(a) em tendências de performance. Sua missão é COMPARAR a ANÁLISE ATUAL com os DADOS HISTÓRICOS para identificar padrões, evoluções e gerar recomendações acionáveis.\n\n- Use emojis para facilitar a leitura.\n- Gere OBRIGATORIAMENTE uma TABELA de comparação das métricas-chave.\n- A comparação é SEMPRE “cada período HISTÓRICO vs o PERÍODO ATUAL”.\n\n============================================================\n2) DADOS DE ENTRADA\n============================================================\n• Período de referência da análise atual: {{ $('Formata data').first().json.period_type_translated.toLowerCase() }}.\n• Históricos: JSON com as últimas análises (anteriores à atual):\n  {{ JSON.stringify($json) }}\n\nConvenção de leitura:\n- HISTÓRICOS: considere que {{ JSON.parse($json.analysis).length }} itens anteriores estão em JSON.parse($json.analysis) (array).\n- ANÁLISE ATUAL: é o bloco já gerado anteriormente “itens 1 a 6” nesta execução (texto estruturado). Se também vier como JSON, nomeie-o internamente de ANALISE_ATUAL_JSON.\n\nCampos esperados por período (quando disponíveis):\n- CPL (custo por lead) — número (R$)\n- CTR (%) — número (0–100%)\n- Click→Lead (%) — número (0–100%)\n- CPM (R$) — número (R$)\n\nSe algum campo estiver ausente em um período, marque como “—” e NÃO pare a análise.\n\n============================================================\n3) REGRAS GERAIS (SIGA À RISCA)\n============================================================\nA) Deixe explícito que a análise considera os ÚLTIMOS {{ JSON.parse($json.analysis).length }} PERÍODOS (históricos) vs o PERÍODO ATUAL.\nB) A COMPARAÇÃO deve ser feita para CADA PERÍODO ANTERIOR vs o ATUAL (não confunda com “vs seu período anterior”). \nC) Produza SEMPRE a TABELA de evolução das 4 métricas (CPL, CTR, Click→Lead, CPM). Sem tabela = ERRO.\nD) Ícones de tendência (ao comparar um período X com o ATUAL):\n   • 📈 melhora\n   • 📉 piora\n   • ➖ estabilidade (variação absoluta < 2% para percentuais; < 2% do valor do ATUAL para valores monetários)\nE) Formatação dos valores:\n   • R$ com duas casas decimais: R$ 123,45\n   • % com duas casas decimais: 12,34%\nF) Ordene os períodos do mais antigo → mais recente → ATUAL.\nG) Nunca invente métricas: apenas calcule/extraia do que foi fornecido.\nH) Se houver divergência de nomes de campos (ex.: cpl vs CPL), normalize para as 4 métricas-padrão.\nI) Se um valor vier como string, faça parsing seguro. Caso falhe, trate como ausente (“—”).\nJ) Não use HTML; apenas texto e tabela em Markdown.\n\n============================================================\n4) PASSOS (ALGORITMO)\n============================================================\n1. Parseie os HISTÓRICOS: hist = JSON.parse($json.analysis) → array de períodos anteriores.\n2. Identifique/extraia, para cada período histórico, os 4 campos (CPL, CTR, Click→Lead, CPM). Normalize nomes.\n3. Identifique os MESMOS 4 campos na ANÁLISE ATUAL (a partir do bloco “itens 1 a 6” ou de ANALISE_ATUAL_JSON, se disponível).\n4. Calcule a variação de cada período ANTERIOR em relação ao ATUAL:\n   - Para %: Δ% = (ValorAnterior - ValorAtual) / |ValorAtual|\n   - Para R$: ΔR$% = (ValorAnterior - ValorAtual) / |ValorAtual|\n   - Sinal: “📈” quando a direção é positiva para a métrica (ex.: CPL menor é melhor; CTR/Click→Lead maior é melhor; CPM menor é melhor).\n     • Métricas “menor é melhor”: CPL, CPM\n     • Métricas “maior é melhor”: CTR, Click→Lead\n   - Aplique “➖” se |Δ| < 0,02 (2%).\n5. Monte a TABELA (ver seção 5), incluindo coluna do ATUAL e, para cada período anterior, o valor e o ícone vs ATUAL.\n6. Com base na tabela, produza “Ganhos Notáveis” e “Perdas Críticas” (seção 6), com bullets curtos e objetivos.\n7. Gere “Insights e Próximos Passos” (seção 7) com recomendações específicas e priorizadas.\n8. Se algum dado estiver ausente, mantenha a tabela e explique em uma nota final o que faltou.\n\n============================================================\n5) SAÍDA — SEÇÃO 1: 📊 TABELA DE EVOLUÇÃO DE MÉTRICAS\n============================================================\n- TITULE claramente: “📊 Tabela de Evolução de Métricas — {{ JSON.parse($json.analysis).length }} períodos anteriores vs Atual ({{ $('Formata data').first().json.period_type_translated.toLowerCase() }})”\n- Linhas = métricas (CPL, CTR, Click→Lead, CPM).\n- Colunas = Período 1 (mais antigo) | ... | Período N (mais recente) | ATUAL.\n- Em cada célula de PERÍODO ANTERIOR, mostre o valor + ícone vs ATUAL. Na coluna ATUAL, mostre apenas o valor.\n- EXEMPLO (apenas ilustrativo; adapte aos seus dados):\n\n| Métrica      | Período -{{JSON.parse($json.analysis).length}} | ... | Período -1 | ATUAL |\n|--------------|-----------------------------------------------|-----|------------|-------|\n| CPL          | R$ 110,00 📉                                  | ... | R$ 95,00 📉  | R$ 80,00 |\n| CTR          | 0,80% 📉                                      | ... | 1,20% 📉     | 1,50% |\n| Click→Lead   | 10,00% 📉                                     | ... | 13,00% 📉    | 15,00% |\n| CPM          | R$ 40,00 📈                                   | ... | R$ 28,00 📈  | R$ 30,00 |\n\n(Interpretação do ícone vs ATUAL: se a métrica for “menor é melhor” e o período anterior tiver valor MAIOR que o ATUAL → 📉; se MENOR → 📈; se ~igual (Δ<2%) → ➖. Para métricas “maior é melhor”, a lógica se inverte.)\n\nATENÇÃO MÁXIMA: A TABELA É OBRIGATÓRIA. SEM TABELA = FALHA.\n\n============================================================\n6) SAÍDA — SEÇÃO 2: 🏆 GANHOS NOTÁVEIS vs 💔 PERDAS CRÍTICAS\n============================================================\nEscreva bullets diretos, comparando ATUAL vs históricos.\n\n- Ganhos Notáveis ✅:\n  • Ex.: “✅ **CPL em queda:** redução média de 22% vs média histórica ({{ JSON.parse($json.analysis).length }} períodos).”\n  • Ex.: “✅ **CTR em alta:** acima do percentil 75% histórico.”\n\n- Perdas Críticas ❌:\n  • Ex.: “❌ **Click→Lead em alerta:** -40% vs ATUAL no Período -1, sugerindo atrito no formulário/página.”\n  • Ex.: “❌ **CPM pressionado:**  +18% vs ATUAL em metade dos períodos, indicando leilão mais caro.”\n\n============================================================\n7) SAÍDA — SEÇÃO 3: 💡 INSIGHTS PARA A PRÓXIMA PERFORMANCE\n============================================================\nEstruture em quatro blocos curtos e práticos:\n\n- Padrão Emergente? 📈📉\n  • Descreva padrões claros (ex.: queda recorrente de CTR de 2 em 2 períodos; sazonalidade; saturação de criativos).\n\n- O que funcionou e devemos REPETIR? 🔁\n  • Aponte táticas, públicos, formatos ou canais associados a melhores resultados nos históricos.\n\n- O que falhou e devemos EVITAR? 🛑\n  • Cite o que puxou as piores variações (ex.: vídeos >30s elevaram CPM; downgrade de público; limitação de verba).\n\n- Próximo Experimento Sugerido 🧪\n  • Defina UM teste A/B prioritário, diretamente ligado à pior queda ou maior oportunidade (ex.: teste de landing com menos campos para recuperar Click→Lead).\n\n============================================================\n8) NOTAS FINAIS & ROBUSTEZ\n============================================================\n- Se algum campo não existir em um período: use “—” e siga adiante.\n- Se os nomes divergirem (ex.: “cost_per_lead”): normalize para CPL.\n- Arredondamento: duas casas decimais para R$ e %.\n- Estabilidade: use “➖” quando |Δ| < 2%.\n- Esclareça explicitamente: “Base: últimos {{ JSON.parse($json.analysis).length }} períodos vs atual ({{ $('Formata data').first().json.period_type_translated.toLowerCase() }}).”\n\n============================================================\n9) MODELO DE RESPOSTA (SOMENTE REFERÊNCIA)\n============================================================\n🔎 Base da análise: últimos {{ JSON.parse($json.analysis).length }} períodos vs ATUAL ({{ $('Formata data').first().json.period_type_translated.toLowerCase() }}).\n\n1) 📊 Tabela de Evolução de Métricas\n| Métrica    | Período -{{JSON.parse($json.analysis).length}} | ... | Período -1 | ATUAL |\n|------------|-----------------------------------------------|-----|------------|-------|\n| CPL        | ...                                           | ... | ...        | ...   |\n| CTR        | ...                                           | ... | ...        | ...   |\n| Click→Lead | ...                                           | ... | ...        | ...   |\n| CPM        | ...                                           | ... | ...        | ...   |\n\n2) 🏆 Ganhos Notáveis ✅\n- ...\n\n💔 Perdas Críticas ❌\n- ...\n\n3) 💡 Insights e Próximos Passos\n- Padrão Emergente? 📈📉: ...\n- Repetir 🔁: ...\n- Evitar 🛑: ...\n- Próximo Experimento 🧪: ...\n\n(Observações: métricas ausentes marcadas como “—”. Emojis indicam variação do período ANTERIOR vs ATUAL.)\n\nFIM DO PROMPT\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[1984,144],"id":"0865f557-5415-4059-876a-e86a5a28aff3","name":"AI - Criar relatório"},{"parameters":{"promptType":"define","text":"=Sua missao é gerar um HTML com base nas informacoes do json {{ $('AI - Criar relatório').item.json.output }} que contem as informações tecnicas do relatório. Seu HTML output deve seguir sempre a mesma estrutura de layout seguindo o template abaixo, adaptando apenas a inclusao das informações com base no json passado anteriormente.\n\nTemplate:\n\n<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Relatório de Performance - Meta Ads</title>\n</head>\n<body style=\"margin:0; padding:0; font-family:Arial, sans-serif; background-color:#f5f5f5;\">\n  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"background-color:#f5f5f5; padding: 20px 0;\">\n    <tr>\n      <td align=\"center\">\n        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"background-color:#ffffff; border-radius:10px; padding:30px;\">\n          <tr>\n            <td align=\"center\" style=\"padding-bottom:20px;\">\n              <h1 style=\"color:#1a1a1a; font-size:24px; margin:0;\">📊 Relatório de Performance</h1>\n              <p style=\"color:#666666; font-size:14px; margin:5px 0 0;\">Meta Ads • Análise Detalhada de Campanhas</p>\n            </td>\n          </tr>\n\n          <!-- Resumo Executivo -->\n          <tr>\n            <td style=\"padding:20px 0; border-top:1px solid #eaeaea;\">\n              <h2 style=\"font-size:18px; color:#1a1a1a; margin-bottom:10px;\">Resumo Executivo</h2>\n              <p style=\"font-size:14px; color:#444444; line-height:1.6;\">\n                A campanha apresenta <strong>performance mista</strong> com pontos positivos e críticos. O CTR está quase <strong>2x acima da meta</strong>, porém o CPM elevado e a baixa conversão Click → Lead estão impactando significativamente o CPL final, que ficou <strong>20% abaixo da meta</strong> estabelecida.\n              </p>\n            </td>\n          </tr>\n\n          <!-- Métricas Principais -->\n          <tr>\n            <td style=\"padding:20px 0;\">\n              <table width=\"100%\" cellpadding=\"10\" cellspacing=\"0\" border=\"0\" style=\"background-color:#fafafa; border-radius:8px;\">\n                <tr>\n                  <td>\n                    <strong>CPM:</strong><br>\n                    <span style=\"font-size:20px; color:#1a1a1a;\">R$ 44,47</span><br>\n                    <span style=\"color:#666;\">Meta: R$ 50,00</span><br>\n                    <span style=\"color:#dc2626;\">-R$ 5,53 (-11,06%)</span>\n                  </td>\n                  <td>\n                    <strong>CTR:</strong><br>\n                    <span style=\"font-size:20px; color:#1a1a1a;\">0,97%</span><br>\n                    <span style=\"color:#666;\">Meta: 0,50%</span><br>\n                    <span style=\"color:#166534;\">+0,47% (+94%)</span>\n                  </td>\n                </tr>\n                <tr>\n                  <td>\n                    <strong>Click → Lead:</strong><br>\n                    <span style=\"font-size:20px; color:#1a1a1a;\">5,78%</span><br>\n                    <span style=\"color:#666;\">Meta: 10,00%</span><br>\n                    <span style=\"color:#dc2626;\">-4,22% (-42,2%)</span>\n                  </td>\n                  <td>\n                    <strong>CPL:</strong><br>\n                    <span style=\"font-size:20px; color:#1a1a1a;\">R$ 79,61</span><br>\n                    <span style=\"color:#666;\">Meta: R$ 100,00</span><br>\n                    <span style=\"color:#166534;\">-R$ 20,39 (-20,39%)</span>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n\n          <!-- Pontos Fortes -->\n          <tr>\n            <td style=\"padding:20px 0;\">\n              <h2 style=\"font-size:18px; color:#1a1a1a;\">✅ Pontos Fortes</h2>\n              <ul style=\"color:#444; font-size:14px; padding-left:20px;\">\n                <li><strong>CTR excepcional (0,97%)</strong>: Os criativos estão muito atrativos</li>\n                <li><strong>CPM controlado</strong>: Boa escolha de público</li>\n              </ul>\n            </td>\n          </tr>\n\n          <!-- Gargalos -->\n          <tr>\n            <td style=\"padding:20px 0;\">\n              <h2 style=\"font-size:18px; color:#1a1a1a;\">⚠️ Gargalo Principal</h2>\n              <p style=\"font-size:14px; color:#444;\">\n                Conversão Click → Lead (5,78%) está abaixo da meta.<br>\n                <strong>Causa provável:</strong> Excesso de fricção no formulário de captura.\n              </p>\n              <ul style=\"color:#444; font-size:14px; padding-left:20px;\">\n                <li>Campos demais</li>\n                <li>Formulário mal posicionado</li>\n                <li>Falta de prova social</li>\n              </ul>\n            </td>\n          </tr>\n\n          <!-- Sugestões -->\n          <tr>\n            <td style=\"padding:20px 0;\">\n              <h2 style=\"font-size:18px; color:#1a1a1a;\">💡 Sugestões de Otimização</h2>\n\n              <p style=\"font-size:14px; color:#1a1a1a; margin:10px 0;\"><strong>🟥 Alta Prioridade – Otimização do Formulário:</strong></p>\n              <ul style=\"color:#444; font-size:14px; padding-left:20px;\">\n                <li>Reduzir campos (Nome, WhatsApp, E-mail)</li>\n                <li>Formulário em etapas</li>\n                <li>Prova social próxima ao formulário</li>\n                <li>Posicionar \"acima da dobra\"</li>\n              </ul>\n\n              <p style=\"font-size:14px; color:#1a1a1a; margin:10px 0;\"><strong>🟥 Alta Prioridade – Landing Page:</strong></p>\n              <ul style=\"color:#444; font-size:14px; padding-left:20px;\">\n                <li>A/B test com versão simplificada</li>\n                <li>Copy alinhada ao anúncio</li>\n                <li>Senso de urgência e escassez</li>\n              </ul>\n\n              <p style=\"font-size:14px; color:#1a1a1a; margin:10px 0;\"><strong>🟨 Média Prioridade – Escalonamento Inteligente:</strong></p>\n              <ul style=\"color:#444; font-size:14px; padding-left:20px;\">\n                <li>Aumentar orçamento gradualmente</li>\n                <li>Duplicar conjuntos de alta performance</li>\n              </ul>\n\n              <p style=\"font-size:14px; color:#1a1a1a; margin:10px 0;\"><strong>🟨 Média Prioridade – Testes Contínuos:</strong></p>\n              <ul style=\"color:#444; font-size:14px; padding-left:20px;\">\n                <li>Manter rotação de criativos</li>\n                <li>Testar novos públicos semelhantes</li>\n              </ul>\n            </td>\n          </tr>\n\n          <!-- Footer -->\n          <tr>\n            <td style=\"padding-top:20px; border-top:1px solid #eaeaea; text-align:center;\">\n              <p style=\"font-size:14px; color:#1a1a1a;\"><strong>🎯 Meta Imediata:</strong> Aumentar a taxa de conversão Click → Lead de 5,78% para 8% nas próximas 2 semanas.</p>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>\n\n-- Seguindo a mesma estrutura de HTML, coloque a análise comparativa a seguir.\n</body>\n</html>\n\n\n\nEste html será utilizado em um email, e por isso você deve devolver apenas o HTML, 100% funcional e organizado. Em sua entrega final (output), nunca inclua \"```json\\n{\\n \"html\": \"\"ou algo do tipo. Apenas o HTML funcional.","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[2560,144],"id":"870f752b-429a-4e82-ab39-6a0a3d7ea097","name":"AI - Criar HTML","executeOnce":false},{"parameters":{"rule":{"interval":[{"triggerAtHour":8}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[0,0],"id":"57bfc528-d0b3-4768-8516-d979e1755d9f","name":"Cron diário"},{"parameters":{"rule":{"interval":[{"field":"weeks","triggerAtHour":8}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[0,256],"id":"6cc7cf43-0347-412c-a6ff-eb3c28a47b21","name":"Cron semanal"},{"parameters":{"jsCode":"return $input.first().json"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[512,144],"id":"7448544c-646f-49c9-848d-484a7f7152dc","name":"Formata data"},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"campaign_analysis","mode":"list","cachedResultName":"campaign_analysis"},"columns":{"mappingMode":"defineBelow","value":{"analysis":"={{ $json.output }}","period_type":"={{ $('Formata data').first().json.period_type }}","ads_name":"Meta"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"analysis","displayName":"analysis","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"ads_name","displayName":"ads_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"period_type","displayName":"period_type","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2336,144],"id":"1b3cab44-b3f8-4f37-aae3-a43bd1071134","name":"Insert rows in a table","credentials":{"postgres":{"id":"pXgXB3fm4CWNM9Pd","name":"Postgres account"}}},{"parameters":{"jsCode":"const period_type_translated = 'Diário'\nreturn {\n  date_preset: \"yesterday\",\n  period_type: \"daily\",\n  period_type_translated,\n  text: (() => {\n    const d = new Date();\n    d.setDate(d.getDate() - 1);\n    const fmt = x => `${String(x.getDate()).padStart(2,'0')}/${String(x.getMonth()+1).padStart(2,'0')}/${x.getFullYear()}`;\n    return `${period_type_translated} - ${fmt(d)}`;\n  })()\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,0],"id":"007c7728-06c3-4dc4-b162-580fd4cb64a4","name":"Normaliza dados diários"},{"parameters":{"jsCode":"const period_type_translated = 'Semanal'\nreturn {\n  date_preset: \"last_7d\",\n  period_type: \"weekly\",\n  period_type_translated,\n  text: (() => {\n    const end = new Date();\n    const start = new Date();\n    start.setDate(end.getDate() - 7);\n    const fmt = d => `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;\n    return `${period_type_translated} - ${fmt(start)} até ${fmt(end)}`;\n  })()\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[208,256],"id":"0c6cb640-c04e-454a-85ca-9c8383944649","name":"Normaliza dados semanais"},{"parameters":{"operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"campaign_analysis","mode":"list","cachedResultName":"campaign_analysis"},"limit":4,"where":{"values":[{"column":"period_type","value":"={{ $('Formata data').item.json.period_type }}"}]},"sort":{"values":[{"column":"id","direction":"DESC"}]},"options":{"outputColumns":["created_at","period_type","analysis"]}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1552,144],"id":"588ee16e-55c7-4e4e-921e-58836896c438","name":"Select rows from a table","credentials":{"postgres":{"id":"pXgXB3fm4CWNM9Pd","name":"Postgres account"}}},{"parameters":{"fromEmail":"Apresenta.me <no-reply@apresenta.me>","toEmail":"joao.rorato@apresenta.me, maicon@apresenta.me,\tguilherme.lindner@apresenta.me, erickmacielmazanti@gmail.com","subject":"=📊 Análise de Campanhas | {{ $('Formata data').first().json.text }}","html":"={{ $json.output }}","options":{"appendAttribution":false,"ccEmail":"="}},"type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[2928,144],"id":"ad7663cf-4d64-4dd5-bab6-61d2b544aa5e","name":"Envia e-mail1","webhookId":"b8842732-9025-4c04-924e-06cfbb051a19","notesInFlow":false,"credentials":{"smtp":{"id":"aeF6k2hPp8cZPPHg","name":"SMTP account"}}},{"parameters":{"jsCode":"return {\n  analysis: JSON.stringify($input.all())\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1760,144],"id":"151fcd77-bccf-4505-9f72-94c5fa6e5316","name":"Transforma análises em texto"}],"connections":{"Pega os ids das campanhas com insights":{"main":[[{"node":"Busca campanhas","type":"main","index":0}]]},"Busca insights":{"main":[[{"node":"Pega os ids das campanhas com insights","type":"main","index":0}]]},"Busca campanhas":{"main":[[{"node":"Junta as informações de campanha com insights","type":"main","index":0}]]},"Anthropic Chat Model2":{"ai_languageModel":[[{"node":"AI - Criar relatório","type":"ai_languageModel","index":0}]]},"Junta as informações de campanha com insights":{"main":[[{"node":"Select rows from a table","type":"main","index":0}]]},"Anthropic Chat Model3":{"ai_languageModel":[[{"node":"AI - Criar HTML","type":"ai_languageModel","index":0}]]},"AI - Criar relatório":{"main":[[{"node":"Insert rows in a table","type":"main","index":0}]]},"AI - Criar HTML":{"main":[[{"node":"Envia e-mail1","type":"main","index":0}]]},"Cron diário":{"main":[[{"node":"Normaliza dados diários","type":"main","index":0}]]},"Cron semanal":{"main":[[{"node":"Normaliza dados semanais","type":"main","index":0}]]},"Formata data":{"main":[[{"node":"Busca insights","type":"main","index":0}]]},"Insert rows in a table":{"main":[[{"node":"AI - Criar HTML","type":"main","index":0}]]},"Normaliza dados diários":{"main":[[{"node":"Formata data","type":"main","index":0}]]},"Normaliza dados semanais":{"main":[[{"node":"Formata data","type":"main","index":0}]]},"Select rows from a table":{"main":[[{"node":"Transforma análises em texto","type":"main","index":0}]]},"Transforma análises em texto":{"main":[[{"node":"AI - Criar relatório","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Cron diário":{"recurrenceRules":[]},"node:Cron semanal":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"46ba1cd3-1e8a-405b-932a-bce76d03c90a","triggerCount":2,"shared":[{"createdAt":"2025-09-22T19:32:48.296Z","updatedAt":"2025-09-22T19:32:48.296Z","role":"workflow:owner","workflowId":"YxaBUSS3T4m872sV","projectId":"4ToGMYJEWvvDSbcz"}],"tags":[]}