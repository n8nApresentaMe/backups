{"createdAt":"2025-08-16T14:49:36.978Z","updatedAt":"2025-10-02T14:57:05.000Z","id":"Mf8XNJsuIL3652pf","name":"❤️ Análise de Lead","active":true,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"lead-timeline","responseMode":"lastNode","options":{}},"id":"3306c9b3-336b-4b4e-93ac-aaf207a932c0","name":"Webhook (Lead Timeline)","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-7696,2032],"webhookId":"0baf53e6-8557-49d0-8377-7fe4a87a204e"},{"parameters":{"jsCode":"const { activities, comments, stageHistory } = $('Buscar dados da Timeline do Lead').first().json\n\nfunction toBrazilDate(dateString) {\n  const date = new Date(dateString);\n  date.setHours(date.getHours() - 3);\n  return date;\n}\n\nconst data = []\n\nasync function mapperActivities() {\n  for (const item of activities) {\n    const createdAt = toBrazilDate(item.CREATED)\n    const lastUpdatedAt = toBrazilDate(item.LAST_UPDATED)\n    const startedAt = toBrazilDate(item.START_TIME)\n    const finishedAt = toBrazilDate(item.END_TIME)\n                                    \n    const mappedActivity = {\n      historyName: 'activity',\n      registerId: item.ID, \n      subject: item.SUBJECT,\n      typeId: item.PROVIDER_TYPE_ID,\n      isCompleted: item.COMPLETED == 'Y',\n      createdAt, \n      lastUpdatedAt,\n      startedAt,\n      finishedAt\n    }\n\n    if (item.CALL_DETAILS) {\n      const call = item.CALL_DETAILS\n      \n      mappedActivity.callDetails = {\n        registerId: call.ID,\n        category: call.CALL_CATEGORY,\n        durationInSeconds: call.CALL_DURATION,\n        callUrl: call.CALL_RECORD_URL,\n        callCost: call.COST, \n        callCostCurrency: call.COST_CURRENCY, \n        callKey: call.CALL_ID\n      }\n    }\n    \n    data.push(mappedActivity)\n  }\n}\nfunction mapperComments() {\n  for (const item of comments) {\n    const createdAt = toBrazilDate(item.CREATED)\n    \n    const mappedComments = {\n      historyName: 'comment',\n      registerId: item.ID,\n      createdAt,\n      comment: item.COMMENT\n    }\n\n    data.push(mappedComments)\n  }\n}\nfunction mapperStageHistory() {\n  for (const item of stageHistory) {\n    const createdAt = toBrazilDate(item.CREATED_TIME) \n    \n    const mappedStageHistory = {\n      historyName: 'stageHistory',\n      registerId: item.ID,\n      status: item.STATUS_ID,\n      createdAt\n    }\n\n    data.push(mappedStageHistory)\n  }\n}\n\nawait mapperActivities();\nawait mapperComments();\nawait mapperStageHistory();\n\nreturn data\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6176,2048],"id":"9ff28547-cf67-453a-b273-e9f3e9abbda5","name":"Mapear dados do CRM"},{"parameters":{"jsCode":"const { leadId } = $('Webhook (Lead Timeline)').first().json.query\n\nif (!leadId) {\n  throw new Error('É necessário informar o id do lead.')\n}\n\nreturn [{\n  leadId \n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-7280,2032],"id":"64452bca-9aa3-4faf-9d3c-78944cfe8fda","name":"Valida parâmetros"},{"parameters":{"jsCode":"const sleep = (ms) => new Promise((r) => setTimeout(r, ms));\n\nasync function bitrixList(method, params) {\n  const url = `${$env.BITRIX_URL}${method}`;\n  let start = 0;\n  const out = [];\n  let tries = 0;\n\n  while (true) {\n    const body = { ...params };\n    if (start) body.start = start;\n\n    try {\n      const res = await this.helpers.httpRequest({\n        method: \"POST\",\n        url,\n        json: true,\n        body,\n        timeout: 30000,\n      });\n\n      let items = Array.isArray(res?.result) ? res.result : [];\n      items = !items.length && (typeof res?.result == 'object') ? res?.result.items : items \n      out.push(...items);\n\n      if (res?.next !== undefined && res.next !== null) {\n        start = res.next;\n        tries = 0;\n        await sleep(200);\n      } else {\n        break;\n      }\n    } catch (err) {\n      if (++tries <= 3) {\n        await sleep(500 * tries);\n        continue;\n      }\n      throw new Error(`Falha em ${method}: ${err.message || String(err)}`);\n    }\n  }\n  return out;\n}\n\nconst leadId = $input.first().json.id\n\nconst a1 = await bitrixList(\"crm.activity.list\", {\n  entityTypeId: 1,\n  order: { ID: \"ASC\" },\n  filter: { \"OWNER_ID\": leadId },\n  select: [\n    \"ID\",\n    \"SUBJECT\",\n    \"PROVIDER_TYPE_ID\",\n    \"COMPLETED\",\n    \"CREATED\",\n    \"LAST_UPDATED\",\n    \"START_TIME\",\n    \"END_TIME\"\n  ],\n});\n\nconst a2 = await bitrixList(\"crm.timeline.comment.list\", {\n  filter: {\n    ENTITY_ID: leadId,\n    ENTITY_TYPE: \"lead\",\n  },\n  select: [\"ID\", \"COMMENT\", \"CREATED\", \"AUTHOR_ID\", \"FILES\"],\n});\n\nconst a3 = await bitrixList(\"crm.stagehistory.list\", {\n    entityTypeId: 1,\n    order: { \"ID\": \"DESC\"},\n    filter: { \"OWNER_ID\": leadId },\n    select: [\"ID\", \"STATUS_ID\", \"CREATED_TIME\"],\n});\n\nfor (const item of a1) {\n    if (item.PROVIDER_TYPE_ID == 'CALL') {\n      const base = \"https://crm.apresenta.me/rest/1/2a5nmkk1mq5yvpvx\";\n      const url = `${base}/voximplant.statistic.get.json`;\n      \n      const res = await this.helpers.httpRequest({\n        method: \"POST\",\n        url,\n        json: true,\n        body: {\n          \"filter\": {\n            \"CRM_ACTIVITY_ID\": item.ID,\n            \">CALL_DURATION\": 30\n          },\n          \"order\": {\n            \"CALL_START_DATE\": \"DESC\"\n          },\n          \"start\": 0,\n          \"select\": [\n            \"CALL_ID\",\n            \"CALL_TYPE\",\n            \"CALL_START_DATE\",\n            \"DURATION\",\n            \"COMMENT\"\n          ]\n        },\n        timeout: 30000,\n      });\n  \n      item.CALL_DETAILS = res.result[0]\n    }  \n}\n\nconst out = [\n  {\n    activities: a1,\n    comments: a2,\n    stageHistory: a3,\n  },\n];\n\nreturn out;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6560,2048],"id":"3f3bfea8-fb8f-4b2c-82e6-98a5eaf9c57f","name":"Buscar dados da Timeline do Lead"},{"parameters":{"jsCode":"const messages = $input.first().json.messages\n\nreturn {\n  messages: messages?.data?.filter(message => ['audio', 'audioMessage'].includes(message.messageType) && !!message.mediaUrl && !!message.file).map(message => ({ json: message })) || []\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5552,2816],"id":"e5c90540-33f2-440b-801f-ffd4e215323d","name":"Filtra por áudio"},{"parameters":{"jsCode":"const stories = $input.all()\n\nreturn {\n  stories: stories.filter(history => history.json.historyName === 'activity' && history.json.typeId === 'CALL' && !!history.json.callDetails?.callUrl && history.json.isCompleted)\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6384,2048],"id":"fd502f8a-acdc-4991-be4e-28448f31fc62","name":"Filtra por call"},{"parameters":{"jsCode":"const allStories = $('Mapear dados do CRM').all()\nconst allStoriesMap = new Map()\nconst historyCalls = $('Filtra por call').first().json.stories\nconst transcribedCalls = $input.all()\n\nfor (const history of allStories) {\n  allStoriesMap.set(`${history.json.registerId}-${history.json.historyName}`, history)\n\n}\n\nfor (const transcribed of transcribedCalls) {\n  const call = historyCalls[transcribed.pairedItem.item]\n  const transcription = transcribed.json.text\n\n  call.json.callDetails = {\n    ...call.json.callDetails, \n    transcription\n  }\n  \n  allStoriesMap.set(`${call.json.registerId}-${call.json.historyName}`, call)\n}\n\nreturn Array.from(allStoriesMap.values())"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5424,2048],"id":"3ccf0972-21f7-4255-9f4e-0e8031325ed7","name":"Junta as transcrições com a timeline"},{"parameters":{"jsCode":"const allMessages = $('Busca Mensagens do lead no Apre.Chat').first().json.messages.data\nconst allMessagesMap = new Map()\nconst audioMessages = $('Filtra por áudio').first().json.messages\nconst transcribedAudios =  $input.all()\n\nfor (const message of allMessages) {\n  allMessagesMap.set(String(message.id), {json:{\n    ...message\n  }})\n}\n\nconsole.log(audioMessages)\nconsole.log(transcribedAudios)\n\nfor (const transcribed of transcribedAudios) {\n  const audioMessage = audioMessages[transcribed.pairedItem.item]\n  const transcription = transcribed.json.text\n\n  allMessagesMap.set(String(audioMessage.json.id), {\n    json: {\n      ...audioMessage, \n      transcription: transcription\n    }\n  })\n}\n\nreturn Array.from(allMessagesMap.values())\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4624,2816],"id":"a6cef695-101b-4c4d-9a79-870ff6d92f9f","name":"Junta as transcrições com as mensagens"},{"parameters":{"method":"POST","url":"https://api.apresenta.me/comercial/bitrix/leadGet","sendQuery":true,"queryParameters":{"parameters":[{"name":"id","value":"={{ $json.leadId }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-7072,2032],"id":"426a5cc3-fa3b-469b-ad52-f9ae6d24bb01","name":"Busca dados do Lead"},{"parameters":{"url":"=https://api.apre.chat/api/messages/{{ $json.whatsapp || '00' }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer kZaOTd+YZpjRUyyuQUpigJaEMk4vcW4YOymKPZX0Ts8="},{"name":"company","value":"10"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-6144,2512],"id":"2f1cc56f-f209-4557-998e-6088ede36761","name":"Busca Mensagens do lead no Apre.Chat","onError":"continueRegularOutput"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-3568,2288],"id":"de3dac9e-cb12-4c23-a354-3476a602da8b","name":"Junta mensagens com histórico da timeline do Lead","alwaysOutputData":true},{"parameters":{"method":"POST","url":"https://n8n.apresenta.me/webhook/audio-transcribe","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"url\": \"{{ $json.url }}\", \n  \"key\": \"{{ $json.key }}\",\n  \"force\": {{ $json.force }}\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-5632,2048],"id":"6d1d563b-6b59-4aa8-a107-57604de7727b","name":"Transcrever calls"},{"parameters":{"jsCode":"const calls = $input.first().json.stories\n\nreturn calls.map(call => ({\n  url: call.json.callDetails.callUrl, \n  key: `${call.json.callDetails.registerId}_${call.json.callDetails.callKey}`,\n  force: $('Webhook (Lead Timeline)').first().json.query.force == 'Y'\n}))"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5856,2048],"id":"81851c23-0714-4941-9188-9f82e677ea00","name":"Mapear url das calls"},{"parameters":{"jsCode":"const audios = $(\"Filtra por áudio\").first().json.messages\n\nreturn audios?.map(audio => ({\n  url: audio.json.mediaUrl, \n  force: $('Webhook (Lead Timeline)').first().json.query.force == 'Y',\n  key: `${audio.json.id}_${audio.json.file.fileName}`\n}))"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5056,2816],"id":"43d2abdf-490c-43f4-8aee-49f75ccb7670","name":"Mapear url dos áudios"},{"parameters":{"method":"POST","url":"https://n8n.apresenta.me/webhook/audio-transcribe","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"url\": \"{{ $json.url }}\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-4848,2816],"id":"28045f47-9912-41ec-a18c-6b331bcc5ef7","name":"Transcrever audios"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0e7bb9f9-1d07-47aa-b731-59c869540da5","leftValue":"={{ $json.whatsapp?.length.toBoolean() }}","rightValue":"","operator":{"type":"boolean","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6416,2528],"id":"5e554bf1-576c-40b0-b655-fe3608411f3a","name":"Verifica se o Lead tem WhatsApp cadastrado"},{"parameters":{"jsCode":"const stories = $input.all()\nconst sortedStories = stories.sort((a, b) => new Date(a.json.createdAt) - new Date(b.json.createdAt))\nreturn {\n  sortedStories\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3360,2288],"id":"e24c935c-bcb2-43d7-ac1c-dd7c67d2b449","name":"Ordena por data de criação"},{"parameters":{"jsCode":"return $('Busca Mensagens do lead no Apre.Chat').first().json.messages?.data?.map(message => ({\n  historyName: 'whatsAppMessage', \n  ...message  \n}))"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5360,2816],"id":"1eec0f50-b2d9-4169-99fd-e68a215b5f96","name":"Normaliza dados"},{"parameters":{"method":"POST","url":"={{ $env.BITRIX_URL }}crm.timeline.logmessage.add","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"fields\": {\n        \"entityTypeId\": 1,\n        \"entityId\": \"{{ $json.query.leadId }}\",\n        \"title\": \"❤️ Análise de Lead inciada.\",\n        \"text\": \"Análise do Lead foi iniciada com sucesso!\",\n        \"iconCode\": \"task-activity\"\n    }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-7488,2032],"id":"a16315e5-40a7-4cc0-8c37-881c9adbecbc","name":"Salva Log no Lead","retryOnFail":true},{"parameters":{"method":"POST","url":"={{ $env.BITRIX_URL }}crm.lead.update","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"id\": \"{{ $('Busca dados do Lead').first().json.id }}\",\n    \"fields\": {\n        \"UF_CRM_LEAD_ANALYSIS\": {{ $json.lead.analysisWithoutEmojiEncoded }},\n        \"UF_CRM_LEAD_ANALYSIS_DATE\": \"{{ (() => { const d = new Date(); const pad = n => String(n).padStart(2,'0'); const tz = -d.getTimezoneOffset(); const sign = tz >= 0 ? '+' : '-'; const h = pad(Math.floor(Math.abs(tz) / 60)); const m = pad(Math.abs(tz) % 60); return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}${sign}${h}:${m}`; })() }}\"\n    }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2384,2288],"id":"0c01e545-6cdf-4611-ac37-3626f9c27d1a","name":"✏️ Altera dados do Lead","retryOnFail":true},{"parameters":{"method":"POST","url":"={{ $env.BITRIX_URL }}crm.timeline.comment.add","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"fields\": {\n        \"ENTITY_TYPE\": \"lead\",\n        \"ENTITY_ID\": \"{{ $('Busca dados do Lead').first().json.id }}\",\n        \"COMMENT\": {{ $('Ajusta informações').item.json.lead.analysisBbCodeEncoded }}\n    }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2192,2288],"id":"63037e52-99b6-4c48-a6fe-eb557a46fd43","name":"Salva comentário com Análise no Lead","retryOnFail":true},{"parameters":{"jsCode":"function removeEmojis(str) {\n  const re = /(?:[\\u{1F1E6}-\\u{1F1FF}]{2}|[#*0-9]\\uFE0F?\\u20E3|\\p{Extended_Pictographic}(?:\\uFE0F|\\u200D(?:\\p{Extended_Pictographic}|\\u2640|\\u2642)\\uFE0F?)*|\\uFE0F|\\u200D)/gu;\n  return str.replace(re, '');\n}\n\n\nfunction markdownToBBCode(markdown) {\n  return markdown\n    // Títulos\n    .replace(/^### (.*$)/gim, '[b]$1[/b]')\n    .replace(/^## (.*$)/gim, '[b]$1[/b]')\n    .replace(/^# (.*$)/gim, '[b]$1[/b]')\n\n    // Negrito\n    .replace(/\\*\\*(.*?)\\*\\*/g, '[b]$1[/b]')\n\n    // Itálico (opcional, se quiser suportar *texto*)\n    .replace(/\\*(.*?)\\*/g, '[i]$1[/i]')\n\n    // Quebras de linha duplas viram parágrafo\n    .replace(/\\n{2,}/g, '\\n\\n')\n}\n\nreturn {\n  lead: {\n    id: $('Busca dados do Lead').first().json.id,\n    analysisBbCodeEncoded: JSON.stringify(markdownToBBCode($input.first().json.output)),\n    analysisWithoutEmojiEncoded: JSON.stringify(removeEmojis($input.first().json.output)),\n  }\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2576,2288],"id":"5c027103-47e7-47d2-8d3e-81b306b59e69","name":"Ajusta informações"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"dcb1dc1a-aa81-4222-a916-5aad835db918","leftValue":"={{ $('Filtra por call').item.json.stories.length.toBoolean() }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6016,1888],"id":"bae7ab7b-7642-4231-8fbe-d8dbcaa60acd","name":"Se tiver call na timeline"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"571ae3a5-3f06-46ff-bae6-6ced09fb6ca4","leftValue":"={{ $json._original.UF_CRM_LEAD_ANALYSIS }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}},{"id":"8ee34270-f834-401c-9cd9-83d920a86df9","leftValue":"={{ $('Webhook (Lead Timeline)').item.json.query.force == 'Y' }}","rightValue":"=","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-6864,2032],"id":"7ec174e4-4081-43c4-997d-d8ddde97cdb1","name":"Se o Lead já tiver análise"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"eeeab0b2-44f3-4838-9a0c-30110ac166f2","leftValue":"={{ $('Filtra por áudio').item.json.messages.length.toBoolean() }}","rightValue":"True","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{"ignoreCase":false}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-5200,3008],"id":"601c9e9e-b2d1-415b-8bf2-abb5f38ee3b2","name":"Verifica se tem audio nas mensagens","alwaysOutputData":false},{"parameters":{"method":"POST","url":"={{ $env.BITRIX_URL }}crm.lead.update","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"id\": \"{{ $('Busca dados do Lead').item.json.id }}\",\n    \"fields\": {\n        \"UF_CRM_LEAD_ANALYSIS_DATE\": \"{{ (() => { const d = new Date(); const pad = n => String(n).padStart(2,'0'); const tz = -d.getTimezoneOffset(); const sign = tz >= 0 ? '+' : '-'; const h = pad(Math.floor(Math.abs(tz) / 60)); const m = pad(Math.abs(tz) % 60); return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}${sign}${h}:${m}`; })() }}\"\n    }\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-6576,1568],"id":"2da60f4f-67a6-4df8-8aca-6bccc31a6bfd","name":"Altera da da última Análise de Lead","retryOnFail":true},{"parameters":{"jsCode":"const stories = $('Ordena por data de criação').first().json.sortedStories;\n\nlet compressedHistory = [];\n\nfor (const story of stories) {\n  const item = story.json;\n  const createdAt = item.createdAt || item.CREATED_TIME || item.CREATED;\n  let entry = '';\n\n  switch (item.historyName) {\n    case 'whatsAppMessage':\n      const sender = item.fromMe ? 'Vendedor' : 'Lead';\n      let messageContent = item.body || item.caption || '';\n      if (item.transcription) {\n        messageContent += ` [Transcrição do Áudio: ${item.transcription}]`;\n      }\n      entry = `[${sender} (WhatsApp) - ${createdAt}]: ${messageContent}`;\n      break;\n\n    case 'activity':\n      let activityDetails = `Assunto: ${item.subject}. Status: ${item.isCompleted ? 'Concluída' : 'Pendente'}.`;\n      if (item.callDetails && item.callDetails.transcription) {\n        activityDetails += ` Transcrição: ${item.callDetails.transcription}`;\n      }\n      entry = `[ATIVIDADE (CRM) - ${createdAt}]: ${activityDetails}`;\n      break;\n\n    case 'comment':\n      entry = `[COMENTÁRIO (CRM) - ${createdAt}]: ${item.comment}`;\n      break;\n\n    case 'stageHistory':\n      entry = `[MUDANÇA DE ETAPA (CRM) - ${createdAt}]: Status do Lead alterado para \"${item.status}\".`;\n      break;\n      \n    default:\n      continue;\n  }\n  \n  compressedHistory.push(entry);\n}\n\nreturn [{\n  json: {\n    compressedHistory: compressedHistory.join('\\n---\\n')\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3152,2288],"id":"0879117a-8cfa-4a68-bf60-125882d169e0","name":"Transforma em texto e comprime"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"claude-sonnet-4-20250514","cachedResultName":"Claude 4 Sonnet"},"options":{"maxTokensToSample":5000}},"type":"@n8n/n8n-nodes-langchain.lmChatAnthropic","typeVersion":1.3,"position":[-2928,2256],"id":"f4b7c61c-25cf-491e-ab35-fecbef8ca857","name":"Anthropic Chat Model","credentials":{"anthropicApi":{"id":"lyfyzPeMl3RhkeP5","name":"Anthropic account"}}},{"parameters":{"promptType":"define","text":"=🚀 Você é um Diretor de Vendas Sênior. Sua missão é criar uma Análise Crítica de Lead no ramo imobiliário para a Apresenta.me. \nObjetivo: produzir um BRIEFING ESTRATÉGICO DE CONVERSÃO para a reunião marcada, com insights acionáveis, plano de ataque, scripts prontos e priorização de próximos passos.\n⚠️ Use exclusivamente os dados do JSON de histórico. NÃO invente nada.\n\nOBS: Esta análise será feita sempre que uma reunião de vendas for agendada para o Lead em questão.\n\n[REGRAS FIXAS — NÃO ALTERAR]\n- Idioma: PT-BR\n- NÃO altere links/IDs a seguir.\n- Nome do Lead: \"{{ $('Busca dados do Lead').first().json.name }}\"\n- Id do Lead (link CRM): https://crm.apresenta.me/crm/lead/details/{{ $('Busca dados do Lead').first().json.id }}/\n- Fonte ÚNICA de verdade: {{ $json.compressedHistory }}  (Histórico de Interações)\n- Identifique dentro das mensagens quem é o lead; ignore suposições sem evidência.\n\n[ENTRADA]\n- Histórico de Interações (JSON comprimido): {{ $json.compressedHistory }}\n\n[MODO DE ANÁLISE — COMO PENSAR]\n1) Rigor de evidências: justifique conclusões com trechos do histórico em aspas curtas “...”. \n2) Temporalidade: monte uma linha do tempo objetiva (datas/horas → evento → evidência).\n3) Enquadramento Comercial: extraia sinais para BANT, MEDDICC e SPICED (preencha só o que tiver evidência).\n4) Ceticismo & Motivadores: detecte tom (urgência/risco/política interna) e motivadores (⏳ tempo, 💸 receita, 🛡️ segurança, 🗂️ organização).\n5) Concorrência: GRIFE qualquer menção a soluções atuais/concorrentes e descreva implicações.\n6) Saída curta e letal: bullets, clareza e ações concretas. Use emojis para níveis/estados ✅⚠️⛔️🔥.\n\n[FORMATO DA SAÍDA — TXT/Markdown SIMPLES. SIGA À RISCA]\n\n0) CABEÇALHO RÁPIDO\n- 👤 Lead: {{ $('Busca dados do Lead').first().json.name }}\n- 🔗 CRM: https://crm.apresenta.me/crm/lead/details/{{ $('Busca dados do Lead').first().json.id }}/\n- 🧭 Resumo em 2 linhas: (síntese objetiva da dor + objetivo do lead, evidenciada por “...”)\n\n1) LINHA DO TEMPO ESSENCIAL ⏱️\n(Ordem cronológica. Se houver data/hora, use DD/MM HH:MM)\n- DD/MM HH:MM — Evento → evidência “...”\n- DD/MM HH:MM — Evento → evidência “...”\n- DD/MM HH:MM — Evento → evidência “...”\n\n2) CONTEXTO & NECESSIDADES 🔍\n- Dores principais (🔥) — cada bullet com citação:\n  • “...”\n  • “...”\n- Perfil aparente (porte, cargo, maturidade técnica): “...”\n- Soluções/Concorrentes citados 🥊 (GRIFAR):\n  • __“...”__ → implicação/risco “...”\n  • __“...”__ → implicação/risco “...”\n\n3) PERSONA & NÍVEL DE CETICISMO 🤔\n- Persona dominante (ex.: Decisor ROI 👑 / Técnico 👨‍💻 / Gestor 🗂️): evidência “...”\n- Ceticismo: Baixo/Moderado/Alto (🟢/🟡/🔴) — por quê? “...”\n- Motivadores chave: ⏳ / 💸 / 🛡️ / 🗂️ — evidências “...”\n- Sinais de urgência/prazo crítico: “...”\n\n4) SCORE DE FECHAMENTO 💰\n- Probabilidade: Baixa / Média / Alta + Nota (0–10) + Emoji (🧊/🌤️/🔥)\n- Sinais positivos ✅ (bullets com “...”):\n  • “...”\n  • “...”\n- Riscos/Entraves ⚠️ (bullets com “...”):\n  • “...”\n  • “...”\n- Trigger de avanço sugerido (o que destrava o sim): “...”\n\n5) OBJEÇÕES & LACUNAS 🚧\n- Objeções explícitas: “...” → como tratar “...”\n- Objeções implícitas (entrelinhas): “...” → como tratar “...”\n- Dados faltantes (perguntar na call) — 3–7 perguntas objetivas:\n  1) “...?”\n  2) “...?”\n  3) “...?”\n  (Foque em Budget, Authority, Decisão, Prazos, Integrações, KPIs.)\n\n6) ENQUADRAMENTOS COMERCIAIS (preencher só com evidência) 🧩\n- BANT\n  • Budget (💵): “...” ou “sem dados”\n  • Authority (👑): “...”\n  • Need (🔥): “...”\n  • Timeline (🗓️): “...”\n- MEDDICC\n  • Metrics: “...”\n  • Economic Buyer: “...”\n  • Decision Criteria: “...”\n  • Decision Process: “...”\n  • Identify Pain: “...”\n  • Champion: “...”\n  • Competition: “...”\n- SPICED\n  • Situation: “...”\n  • Pain: “...”\n  • Impact: “...”\n  • Critical Event: “...”\n  • Decision: “...”\n\n7) MAPA DE VALOR (Dor → Prova → Recurso) 🎯\n- Estruture 3–6 linhas com evidência real do histórico:\n  • Dor/Objetivo: “...”\n    → Prova/Resultado que importa: “...”\n    → Recurso Apresenta.me: CRM + Apre.Chat / ApBank / ERP / Vistoria / Ass. Eletrônica / Painéis\n  • Dor/Objetivo: “...”\n    → Prova/Resultado: “...”\n    → Recurso: “...”\n\n8) PLANO DE AÇÃO DE 7 DIAS 🔥\n- D0 (hoje): ações táticas (3–5 bullets) — objetivo + critério de sucesso.\n- D1–D2: “...”\n- D3–D5: “...”\n- D6–D7: “...”\n(Exemplos de critérios: resposta do decisor; confirmar critérios de decisão; agendar técnica; enviar proposta ancorada; validar prazo jurídico/financeiro.)\n\n9) TÁTICAS DE REUNIÃO (What / Show / Send) 🧰\n- What to SAY (descoberta de alto impacto — 5–7 perguntas alinhadas às lacunas):\n  • “...?”\n  • “...?”\n- What to SHOW (demonstrações-alvo com prova social/resultado):\n  • “...” (case/indicador relevante)\n- What to SEND (pós-call imediato):\n  • Resumo executivo + próximos passos + prazo acordado.\n\n10) SCRIPTS DE PRÓXIMO CONTATO 📩\n- WhatsApp (curto, direto, com valor e CTA):\n  • “[nome], pelo seu ponto sobre ‘…’, amanhã te mostro como resolvemos isso em X min. Confirma melhor horário entre [opção1] e [opção2]?”\n- E-mail (executivo, 5 linhas, com âncora de resultado):\n  • Assunto: “[resultado] em [prazo] — passo-a-passo”\n  • Corpo: 1) referência à dor “...”; 2) prova/indicador “...”; 3) proposta de próximo passo “...”; 4) duas janelas de horário; 5) CTA claro.\n\n11) ÂNCORAS DE VALOR / ROI 💸\n- Indicadores que mais importam ao lead (do histórico): “...”\n- Micro-business case (com os dados que EXISTEM):\n  • Ex.: “Redução de TMA de ‘…’ para ‘…’ → ganho de ‘…’ horas/mês (⏳) e economia estimada de R$ ‘…’/mês.”\n\n12) RISCOS COMPETITIVOS & CONTRA-ATAQUES 🥊\n- Risco/Concorrente (GRIFADO): __“...”__ \n  • Gap percebido: “...”\n  • Contra-ataque: “...” (prova, demo, case, feature específica)\n- Risco político interno:\n  • “...” → ação: envolver [decisor] / redefinir sucesso / alinhar critério técnico.\n\n13) FIT COM ICP (Adequação) 🧭\n- Fit ICP: Alto/Médio/Baixo (🟢/🟡/🔴) — por quê? “...”\n- Sinais de desvio (se houver): “...”\n- Recomendação: “prosseguir agressivo” / “manter em nutrição” / “desqualificar educadamente”.\n\n14) PONTES COM APRE.CHAT (o que mostrar) 💬\n- Se dor for atendimento/retorno:\n  • Mostrar: distribuição automática, follow-ups, histórico único, métricas de resposta.\n- Se dor for controle/financeiro:\n  • Mostrar: ApBank, conciliação, repasses, inadimplência com alertas.\n- Se dor for operação:\n  • Mostrar: ERP, Vistoria, Assinatura Eletrônica, Painéis.\n\n15) CHECKLIST PRÉ-CALL ✅\n- Confirmar decisores presentes? [ ] \n- Critérios de decisão mapeados? [ ]\n- Timeline acordada? [ ]\n- Próximo passo definido (com data)? [ ]\n- Material de prova separado (case/indicador)? [ ]\n\n[RESTRIÇÕES FINAIS]\n- Não extrapole além do que o histórico comprova.\n- Sempre cite “...” para justificar afirmações importantes.\n- Use emojis para sinalizar níveis e prioridades (ex.: 🔥 prioridade alta, ⚠️ risco, ✅ confirmado).\n- Mantenha o texto enxuto, orientado a ação e pronto para colar no CRM.\n\n[SOBRE A APRESENTA.ME — RESUMO PARA CONTEXTO NA CONVERSA]\n- Plataforma SaaS para imobiliárias (pequenas e médias) focada em eficiência e escala sem ampliar equipe.\n- ERP completo + CRM com IA e WhatsApp (Apre.Chat) + ApBank + Vistoria + Assinatura Eletrônica + Painéis.\n- Benefícios-chave: automação total de locação, funil de vendas organizado, alertas, histórico centralizado, indicadores de performance, suporte humano via WhatsApp, site com SEO.\n- Apre.Chat: integração nativa WhatsApp; automações; distribuição de atendimentos; múltiplos atendentes; histórico no CRM; assinaturas em mensagens (primeira linha com ASSINATURA).\n\n(FIM)\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-2960,2032],"id":"bce78d02-0a88-479f-981c-b99cdffc59f7","name":"Análise da Call de Lead","retryOnFail":true,"maxTries":5,"waitBetweenTries":5000},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a49d6896-c524-4dfe-8579-457dfbd9a51c","leftValue":"={{ $json.messages.data.length.toBoolean() }}","rightValue":"","operator":{"type":"boolean","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-5888,2512],"id":"af57dcb7-137b-4bb3-ab27-d6a758f47388","name":"If"},{"parameters":{"jsCode":"const whatsapp = $input.first().json.whatsapp || '';\n\nreturn {\n  whatsapp: whatsapp.replace(/\\D/g, '') \n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-6640,2432],"id":"250375b0-80e8-420b-a4d7-8cd37949c7c0","name":"Remove caracteres diferentes de numero e espaço do whatsapp do lead"},{"parameters":{"fromEmail":"Apresenta.me <no-reply@apresenta.me>","toEmail":"joao.rorato@apresenta.me","subject":"=💗 Análise de Lead | {{ $('Busca dados do Lead').first().json.last_activity_by_details.name_full }} | {{ $('Busca dados do Lead').first().json.title }}, {{ $('Busca dados do Lead').first().json.company_title }}","html":"={{ $json.message.content }}","options":{"appendAttribution":false,"ccEmail":"={{ $('Busca dados do Lead').first().json.user_seller_details._original.EMAIL }}, {{ $('Busca dados do Lead').first().json.user_sdr_details._original.EMAIL }}"}},"type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[-1680,2288],"id":"4fa4a84c-64a0-4ce7-b80c-a4529d01e25e","name":"Envia análise por e-mail","webhookId":"b8842732-9025-4c04-924e-06cfbb051a19","notesInFlow":false,"credentials":{"smtp":{"id":"aeF6k2hPp8cZPPHg","name":"SMTP account"}}},{"parameters":{"modelId":{"__rl":true,"value":"gpt-5-mini","mode":"list","cachedResultName":"GPT-5-MINI"},"messages":{"values":[{"content":"=Você é um ASSISTENTE ESPECIALISTA em formatação de relatórios de análise de leads para aplicações imobiliárias, focado em e-mails profissionais otimizados para o Gmail, representando o time da Apresenta.me. Sua missão é transformar uma análise/relatório de lead (conteúdo bruto da call de qualificação/demonstração) em HTML de e-mail: bem estruturado, elegante, visualmente atraente e legível em qualquer dispositivo.\n\nINSTRUÇÕES PRINCIPAIS (NÃO IGNORAR)\n- NUNCA ALTERE, RESUMA OU INTERPRETE o conteúdo do relatório original do lead.\n- FORMATE COMO E-MAIL (GMAIL) usando SOMENTE HTML com CSS inline (cores, tabelas, boxes).\n- MANTENHA A ORDEM ORIGINAL das seções, títulos e subtítulos, sem reordenar ou agrupar blocos.\n- USE NEGRITO para títulos e informações importantes.\n- USE ITÁLICO apenas para ênfases pontuais ou na assinatura.\n- ADICIONE EMOJIS de forma moderada para sinalizar ações, status e destaques (ex.: ✅, 🎯, 🔗, ⚠️, 📝).\n- CRIE BOXES com fundo colorido para destaques (cores compatíveis com Gmail).\n- UTILIZE LISTAS (comuns, numeradas ou com emojis) para organizar informações.\n- CONVERTA todas as quebras de linha “\\n” para <br> ou separe em <p> quando necessário.\n- APRESENTE LINKS apenas como hiperlinks clicáveis, antecedidos por 🔗 (ocultar a URL).\n- NUNCA OMITA SEÇÕES, mesmo que o conteúdo pareça repetido, incompleto ou vazio.\n- MANTENHA TODOS OS TÍTULOS visíveis, mesmo que não tenham conteúdo associado.\n- FINALIZE com a assinatura padrão: _Relatório pela <b>Sofia</b>, assistente da Apresenta.me_\n- REVISE ortografia, gramática e legibilidade em desktop e mobile.\n- A SAÍDA DEVE SER SOMENTE O HTML FINAL, sem blocos de código e sem tags externas <html>/<head>/<body>, nem comentários.\n\nCADEIA DE RACIOCÍNIO (COMO PROCEDER)\n1) ENTENDA o objetivo: transformar a análise da call em um e-mail 100% fiel e visualmente otimizado.\n2) IDENTIFIQUE todas as seções do relatório e seus conteúdos, sem ignorar nenhuma.\n3) SEPARE as informações em blocos organizados com títulos claros e destacados em negrito.\n4) DESTAQUE informações cruciais utilizando boxes com fundos coloridos e emojis apropriados.\n5) CONVERTA “\\n” para <br> em blocos de texto e use <p> para parágrafos completos.\n6) INSIRA links como hiperlinks clicáveis precedidos por 🔗, ocultando URLs completas.\n7) GARANTA que todas as seções do texto original estejam presentes no HTML final.\n8) NUNCA REORDENE OU REAGRUPE SEÇÕES. Preserve a ordem original integralmente.\n9) FINALIZE com a assinatura profissional obrigatória e revise ortografia e gramática.\n\nO QUE NÃO FAZER\n- NUNCA modificar, resumir, interpretar ou omitir qualquer informação do relatório original.\n- NÃO inserir comentários, opiniões ou conteúdo adicional.\n- NÃO deixar links sem serem clicáveis ou sem o emoji 🔗.\n- NÃO usar cores excessivas ou visuais que prejudiquem a leitura.\n- NÃO omitir seções vazias ou repetidas; mantenha os títulos mesmo sem conteúdo.\n- NÃO usar sublinhado (exceto em links).\n- NÃO quebrar o HTML nem a estrutura das seções.\n- NÃO formatar em outro padrão que não seja HTML inline compatível com Gmail.\n- NÃO esquecer a assinatura padrão com a Sofia.\n\nENTRADAS (INPUT)\n- Dados do lead/empresa (opcional).\n- RELATÓRIO_BRUTO: texto completo da análise da call do lead, com seções e ordem originais (pode conter “\\n”).\n\nDADOS DE ENTRADA:\n{{ $('Análise da Call de Lead').first().json.output }}\n\nSAÍDA (OUTPUT)\n- Somente HTML inline, pronto para colar no Gmail.\n- Manter a ordem das seções e títulos do RELATÓRIO_BRUTO.\n- Preservar todo o conteúdo textual, apenas formatando visualmente.\n\nREGRAS DE ESTILO (HTML INLINE)\n- Fonte: Helvetica, Arial, sans-serif; line-height: 1.6; color: #333.\n- Largura fluida com margens/paddings inline para boa leitura em mobile e desktop.\n- Títulos (H2/H3 simulados): cor #1a73e8; negrito.\n- Boxes de destaque (usar quando fizer sentido):\n  • Informação: background-color:#E8F0FE; border-radius:6px; padding:12px 14px;\n  • Sucesso/OK: background-color:#E6F4EA; border-radius:6px; padding:12px 14px;\n  • Aviso: background-color:#FFF4E5; border-radius:6px; padding:12px 14px;\n  • Neutro: background-color:#F1F3F4; border-radius:6px; padding:12px 14px;\n- Tabelas (se necessárias): border-collapse: collapse; padding interno; cabeçalho em negrito.\n- Emojis: usar com moderação, apenas para guiar leitura (✅, 🎯, 🔗, ⚠️, 📝).\n\nEXEMPLO DE ESTRUTURA (NÃO MUDA A ORDEM DO CONTEÚDO ORIGINAL — APENAS FORMATA)\n[HEADER COM LOGO]\n<img src=\"https://s.apresenta.me/comercial/automations/apresentame-300.png\" alt=\"Apresenta.me ~ O Futuro das Imobiliárias\" width=\"300\" style=\"display:inline-block;\">\n\n[TÍTULO PRINCIPAL]\n<h2 style=\"color:#1a73e8; font-family: Helvetica, Arial, sans-serif;\">🎯 Análise de Lead | Apresenta.me | NOME DO LEAD ~ ASSUNTO DA CALL</h2>\n\n[SEÇÕES DO RELATÓRIO_BRUTO — repetir a sequência exata do input]\n<strong style=\"font-family: Helvetica, Arial, sans-serif;\">Título da Seção</strong>\n<p style=\"margin:8px 0; font-family: Helvetica, Arial, sans-serif;\">Conteúdo literal da seção. Converter \\n em <br> quando necessário.<br>Sem reescrever conteúdo.</p>\n\n[LINKS]\n🔗 <a href=\"URL\" style=\"color:#1a73e8; text-decoration:underline;\">Texto do link</a>\n\n[BOX DE DESTAQUE — opcional quando o texto exigir]\n<div style=\"background-color:#E8F0FE; border-radius:6px; padding:12px 14px; font-family: Helvetica, Arial, sans-serif;\">✅ Informação crítica exatamente como no relatório.</div>\n\n[ASSINATURA OBRIGATÓRIA]\n<p style=\"font-style:italic; margin-top: 30px; border-top:1px solid #ddd; padding-top:10px; font-family: Helvetica, Arial, sans-serif;\">Relatório pela <b>Sofia</b>, assistente da Apresenta.me</p>\n\nINSTRUÇÃO FINAL\n- A saída deve ser SOMENTE o HTML inline, pronto para colagem no Gmail, sem blocos de código, sem comentários e sem tags externas (<html>/<head>/<body>). Manter 100% do conteúdo original do RELATÓRIO_BRUTO e a mesma ordem das seções.","role":"system"},{"content":"={{ $('Análise da Call de Lead').first().json.output }}"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-2000,2288],"id":"4d019612-967a-473a-b71b-c8a7fb4f2fe3","name":"Cria html da analise de Lead","retryOnFail":true,"credentials":{"openAiApi":{"id":"weD4ayyAuWgClQqA","name":"OpenAi account"}}}],"connections":{"Webhook (Lead Timeline)":{"main":[[{"node":"Salva Log no Lead","type":"main","index":0}]]},"Mapear dados do CRM":{"main":[[{"node":"Se tiver call na timeline","type":"main","index":0}]]},"Valida parâmetros":{"main":[[{"node":"Busca dados do Lead","type":"main","index":0}]]},"Buscar dados da Timeline do Lead":{"main":[[{"node":"Filtra por call","type":"main","index":0}]]},"Filtra por áudio":{"main":[[{"node":"Normaliza dados","type":"main","index":0}]]},"Filtra por call":{"main":[[{"node":"Mapear dados do CRM","type":"main","index":0}]]},"Junta as transcrições com a timeline":{"main":[[{"node":"Junta mensagens com histórico da timeline do Lead","type":"main","index":0}]]},"Junta as transcrições com as mensagens":{"main":[[{"node":"Junta mensagens com histórico da timeline do Lead","type":"main","index":1}]]},"Busca dados do Lead":{"main":[[{"node":"Se o Lead já tiver análise","type":"main","index":0}]]},"Busca Mensagens do lead no Apre.Chat":{"main":[[{"node":"If","type":"main","index":0}]]},"Junta mensagens com histórico da timeline do Lead":{"main":[[{"node":"Ordena por data de criação","type":"main","index":0}]]},"Transcrever calls":{"main":[[{"node":"Junta as transcrições com a timeline","type":"main","index":0}]]},"Mapear url das calls":{"main":[[{"node":"Transcrever calls","type":"main","index":0}]]},"Mapear url dos áudios":{"main":[[{"node":"Transcrever audios","type":"main","index":0}]]},"Transcrever audios":{"main":[[{"node":"Junta as transcrições com as mensagens","type":"main","index":0}]]},"Verifica se o Lead tem WhatsApp cadastrado":{"main":[[{"node":"Busca Mensagens do lead no Apre.Chat","type":"main","index":0}]]},"Ordena por data de criação":{"main":[[{"node":"Transforma em texto e comprime","type":"main","index":0}]]},"Normaliza dados":{"main":[[{"node":"Verifica se tem audio nas mensagens","type":"main","index":0}]]},"Salva Log no Lead":{"main":[[{"node":"Valida parâmetros","type":"main","index":0}]]},"✏️ Altera dados do Lead":{"main":[[{"node":"Salva comentário com Análise no Lead","type":"main","index":0}]]},"Ajusta informações":{"main":[[{"node":"✏️ Altera dados do Lead","type":"main","index":0}]]},"Se tiver call na timeline":{"main":[[{"node":"Mapear url das calls","type":"main","index":0}],[{"node":"Junta mensagens com histórico da timeline do Lead","type":"main","index":0}]]},"Se o Lead já tiver análise":{"main":[[{"node":"Altera da da última Análise de Lead","type":"main","index":0}],[{"node":"Buscar dados da Timeline do Lead","type":"main","index":0},{"node":"Remove caracteres diferentes de numero e espaço do whatsapp do lead","type":"main","index":0}]]},"Verifica se tem audio nas mensagens":{"main":[[{"node":"Mapear url dos áudios","type":"main","index":0}],[{"node":"Junta mensagens com histórico da timeline do Lead","type":"main","index":1}]]},"Transforma em texto e comprime":{"main":[[{"node":"Análise da Call de Lead","type":"main","index":0}]]},"Anthropic Chat Model":{"ai_languageModel":[[{"node":"Análise da Call de Lead","type":"ai_languageModel","index":0}]]},"Análise da Call de Lead":{"main":[[{"node":"Ajusta informações","type":"main","index":0}]]},"If":{"main":[[{"node":"Filtra por áudio","type":"main","index":0}]]},"Remove caracteres diferentes de numero e espaço do whatsapp do lead":{"main":[[{"node":"Verifica se o Lead tem WhatsApp cadastrado","type":"main","index":0}]]},"Salva comentário com Análise no Lead":{"main":[[{"node":"Cria html da analise de Lead","type":"main","index":0}]]},"Cria html da analise de Lead":{"main":[[{"node":"Envia análise por e-mail","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook (Lead Timeline)":[{"json":{"headers":{"host":"n8n.apresenta.me","x-real-ip":"172.70.38.224","x-real-port":"64960","x-forwarded-for":"3.217.33.54, 172.70.38.224","x-forwarded-proto":"http","x-forwarded-host":"n8n.apresenta.me","x-forwarded-port":"80","remote-host":"172.70.38.224","connection":"close","content-length":"310","content-type":"application/x-www-form-urlencoded","accept-encoding":"gzip, br","user-agent":"Bitrix24 Webhook Engine","cf-ray":"978d431a9a36082b-IAD","cdn-loop":"cloudflare; loops=1","cf-connecting-ip":"3.217.33.54","cf-ipcountry":"US","cf-visitor":"{\"scheme\":\"https\"}"},"params":{},"query":{"leadId":"75019","force":"N"},"body":{"document_id[0]":"crm","document_id[1]":"CCrmDocumentLead","document_id[2]":"LEAD_75019","auth[domain]":"crm.apresenta.me","auth[client_endpoint]":"https://crm.apresenta.me/rest/","auth[server_endpoint]":"https://oauth.bitrix.info/rest/","auth[member_id]":"e0399350f7ed44f078e2b21954de695d"},"webhookUrl":"https://n8n.apresenta.me/webhook/lead-timeline","executionMode":"production"}}]},"versionId":"b4908314-30e1-464b-ae3e-46288c99f7da","triggerCount":1,"shared":[{"createdAt":"2025-08-16T14:49:36.984Z","updatedAt":"2025-08-16T14:49:36.984Z","role":"workflow:owner","workflowId":"Mf8XNJsuIL3652pf","projectId":"4ToGMYJEWvvDSbcz"}],"tags":[]}